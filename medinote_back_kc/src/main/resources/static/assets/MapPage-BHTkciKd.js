import{c as T,a as o,ao as s}from"./index-D3Bzzjcr.js";import{R as O,K as X}from"./KakaoMap-DMjyBILm.js";import{B as k}from"./Button-C8G8zfQ9.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}]],Z=T("locate",Y);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],P=T("map-pin",ee);function te({title:t="내 주변 병원 · 약국 찾기",onSearch:m,onLocate:n,onReset:i,onTogglePharmacy:v,onToggleHospital:C}){const[u,p]=o.useState(""),x=f=>{f.preventDefault(),m&&m(u)};return s.jsxs("div",{className:"flex items-center justify-between px-6 py-3 border-b bg-white shadow-sm",children:[s.jsx("h1",{className:"text-lg font-semibold text-gray-800",children:t}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("form",{onSubmit:x,className:"flex items-center gap-2",children:[s.jsx("input",{type:"text",value:u,onChange:f=>p(f.target.value),placeholder:"지역 또는 장소를 입력하세요...",className:"px-3 py-2 border rounded-md text-sm w-64 focus:outline-none focus:ring-2 focus:ring-pink-300"}),s.jsx(k,{variant:"white",size:"sm",radius:"md",type:"submit",children:"검색"})]}),s.jsxs("div",{className:"flex items-center gap-2 ml-3",children:[s.jsx(k,{variant:"white",size:"sm",radius:"md",leftIcon:s.jsx(Z,{size:16}),onClick:n,children:"내 위치"}),s.jsx(k,{variant:"white",size:"sm",radius:"md",leftIcon:s.jsx(O,{size:16}),onClick:i,children:"초기화"}),s.jsx(k,{variant:"white",size:"sm",radius:"md",leftIcon:s.jsx(P,{size:16}),onClick:v,children:"약국"}),s.jsx(k,{variant:"white",size:"sm",radius:"md",leftIcon:s.jsx(P,{size:16}),onClick:C,children:"병원"})]})]})]})}function se({places:t=[],onSelect:m,className:n=""}){return t.length?s.jsx("div",{className:`p-4 space-y-3 ${n}`,children:t.map((i,v)=>s.jsxs("div",{onClick:()=>m(i),className:"p-3 border-b cursor-pointer hover:bg-gray-50",children:[s.jsx("h3",{className:"font-semibold text-gray-800",children:i.place_name}),s.jsx("p",{className:"text-sm text-gray-600",children:i.road_address_name}),s.jsx("p",{className:"text-sm text-gray-500",children:i.phone||"전화번호 없음"})]},v))}):s.jsx("div",{className:`text-center text-gray-400 py-8 ${n}`,children:"주변에 검색된 장소가 없습니다."})}const w={lat:37.485899,lng:126.89745},M=5;function le(){const[t,m]=o.useState(null),[n,i]=o.useState(null),[v,C]=o.useState([]),[u,p]=o.useState("병원"),[x,f]=o.useState("병원"),[_,E]=o.useState(!1),[ne,z]=o.useState(null),[I,R]=o.useState(!1),j=o.useRef([]),d=o.useRef(null),K=o.useRef(null),F=o.useCallback((a,e)=>{i(a),m(e),setTimeout(()=>e.relayout(),0);const r=new a.maps.LatLng(w.lat,w.lng);e.setCenter(r),e.setLevel(M)},[]),A=o.useCallback(()=>z(null),[]),D=o.useCallback(({bounds:a})=>{K.current=a,R(!0)},[]);o.useEffect(()=>{if(!t)return;let a;const e=()=>{clearTimeout(a),a=setTimeout(()=>t.relayout(),200)};return window.addEventListener("resize",e),()=>{clearTimeout(a),window.removeEventListener("resize",e)}},[t]);const H=o.useCallback(a=>new Promise((e,r)=>{if(!n)return r(new Error("Kakao not ready"));const{maps:c}=n;new c.services.Places().keywordSearch(a,(h,N)=>{if(N===c.services.Status.OK&&h.length){const{x:l,y}=h[0];return e({lat:parseFloat(y),lng:parseFloat(l),name:h[0].place_name})}new c.services.Geocoder().addressSearch(a,(l,y)=>{if(y===c.services.Status.OK&&l.length){const{x:S,y:J}=l[0];return e({lat:parseFloat(J),lng:parseFloat(S),name:l[0].address_name})}r(new Error("검색 결과 없음"))})})}),[n]),q=o.useCallback((a,e)=>{if(!t||!n)return;const r=new n.maps.LatLng(a,e);d.current?(d.current.setOptions({center:r}),d.current.setMap(t)):(d.current=new n.maps.Circle({center:r,radius:20,strokeWeight:3,strokeColor:"#3b82f6",strokeOpacity:.9,strokeStyle:"solid",fillColor:"#3b82f6",fillOpacity:.3,zIndex:1e3}),d.current.setMap(t))},[t,n]),B=o.useCallback(async()=>null,[]),g=o.useCallback(({useMapBounds:a=!1,centerOverride:e=null}={})=>{if(!t||!n)return;E(!0);const r=new n.maps.services.Places(t);let c;a?c={useMapBounds:!0,bounds:t.getBounds()}:e?c={location:new n.maps.LatLng(e.lat,e.lng),radius:3e3}:c={location:t.getCenter(),radius:3e3};const b=u&&u.trim()||x;r.keywordSearch(b,(h,N)=>{if(E(!1),j.current.forEach(l=>l.setMap(null)),j.current=[],N!==n.maps.services.Status.OK){C([]);return}const L=new n.maps.LatLngBounds;if(h.forEach(l=>{const y=new n.maps.LatLng(l.y,l.x),S=new n.maps.Marker({map:t,position:y});j.current.push(S),L.extend(y)}),!a)if(e)t.setCenter(new n.maps.LatLng(e.lat,e.lng));else{const l=t.getBounds();(!l||!l.contain(L.getSouthWest())||!l.contain(L.getNorthEast()))&&t.setBounds(L)}C(h),R(!1)},c)},[t,n,u,x]);o.useEffect(()=>{g({useMapBounds:!1})},[g,u]);const W=a=>{if(!t||!n)return;const e=new n.maps.LatLng(a.y,a.x);t.panTo(e),z(a)},$=async a=>{const e=a?.trim();if(!e)return p(x);try{const r=await H(e);t.setCenter(new n.maps.LatLng(r.lat,r.lng)),t.setLevel(5),g({useMapBounds:!1,centerOverride:r})}catch(r){console.warn("검색 실패:",r.message)}},G=()=>{if(!t||!n)return;const a=(e,r,c=5)=>{const b=new n.maps.LatLng(e,r);t.setCenter(b),t.setLevel(c),q(e,r),g({useMapBounds:!1,centerOverride:{lat:e,lng:r}})};navigator.geolocation?navigator.geolocation.getCurrentPosition(({coords:e})=>{a(e.latitude,e.longitude,5)},async()=>{const e=await B();if(e)a(e.lat,e.lng,7);else{const r=t.getCenter();a(r.getLat(),r.getLng(),t.getLevel())}},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):(async()=>{const e=await B();if(e)a(e.lat,e.lng,7);else{const r=t.getCenter();a(r.getLat(),r.getLng(),t.getLevel())}})()},Q=()=>{!t||!n||(t.setCenter(new n.maps.LatLng(w.lat,w.lng)),t.setLevel(M),p(x),d.current&&d.current.setMap(null),g({useMapBounds:!1,centerOverride:w}))},U=()=>{f("약국"),p("약국")},V=()=>{f("병원"),p("병원")};return s.jsx("div",{className:"w-full bg-gray-50 px-6 py-6 min-h-[calc(100vh-140px)]",children:s.jsxs("div",{className:"max-w-7xl mx-auto space-y-4",children:[s.jsx(te,{title:"내 주변 병원 · 약국 찾기",onSearch:$,onLocate:G,onReset:Q,onTogglePharmacy:U,onToggleHospital:V}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[minmax(0,1fr)_380px] gap-4",children:[s.jsx("div",{className:"relative rounded-xl shadow",children:s.jsxs("div",{className:"w-full h-[600px] relative",children:[I&&s.jsx("button",{onClick:()=>g({useMapBounds:!0}),className:"absolute z-[100] top-3 left-1/2 -translate-x-1/2 rounded-full bg-white/95 px-4 py-2 text-sm shadow border hover:bg-white",children:"이 지역에서 재검색"}),s.jsx(X,{onReady:F,onClick:A,onIdle:D,center:w,level:M,marker:!1,infoWindowContent:"",className:"absolute inset-0"})]})}),s.jsx("aside",{className:"rounded-xl bg-white shadow h-[600px] flex flex-col",children:_?s.jsx("p",{className:"text-center text-gray-500 py-6",children:"검색 중..."}):s.jsx(se,{places:v,onSelect:W,className:"flex-1 overflow-y-auto"})})]})]})})}export{le as default};
