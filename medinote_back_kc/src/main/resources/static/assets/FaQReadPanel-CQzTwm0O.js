import{aJ as L,al as B,am as H,a,ao as e,an as f}from"./index-D3Bzzjcr.js";function z({onBack:N,showAdminActions:P=!0,listPath:$="/boards/faq"}){const{id:d}=L(),R=B(),{member:n}=H(),[s,q]=a.useState(null),[j,w]=a.useState(!0),[u,v]=a.useState(""),[g,A]=a.useState(!1),[m,p]=a.useState(""),[x,h]=a.useState(""),[y,S]=a.useState(!1),[C,c]=a.useState(""),[D,E]=a.useState(!1),b=a.useRef(!1),i=a.useMemo(()=>{const t=((n?.role||n?.memberRole||n?.roleName)??"")+"",r=Array.isArray(n?.roles)?n.roles:[],l=Array.isArray(n?.authorities)?n.authorities:[];return!!(t.toUpperCase()==="ADMIN"||r.map(o=>(o+"").toUpperCase()).includes("ADMIN")||l.some(o=>typeof o=="string"?o.toUpperCase().includes("ADMIN"):(o?.authority+"").toUpperCase().includes("ADMIN")))},[n]),T=a.useMemo(()=>s?.isPublic===!1?"bg-gray-50 text-gray-700 ring-1 ring-gray-200":"bg-green-50 text-green-700 ring-1 ring-green-200",[s]),k=t=>{if(!t)return"-";try{const r=new Date(t);if(!isNaN(r.getTime())){const l=o=>String(o).padStart(2,"0");return`${r.getFullYear()}-${l(r.getMonth()+1)}-${l(r.getDate())} ${l(r.getHours())}:${l(r.getMinutes())}`}}catch{}return String(t).slice(0,16).replace("T"," ")},I=()=>N?N():R($),F=async t=>{v(""),w(!0);try{const l=(await f.get(`/boards/read/${d}`,{signal:t})).data||null;q(l),p(l?.title??""),h(l?.content??"")}catch(r){if(r?.name==="CanceledError"||r?.code==="ERR_CANCELED")return;console.error(r),v("FAQ를 불러오지 못했습니다.")}finally{w(!1)}};a.useEffect(()=>{if(b.current){b.current=!1;return}b.current=!0;const t=new AbortController;return F(t.signal),()=>t.abort()},[d]);const M=()=>{i&&(c(""),A(t=>!t),s&&(p(s.title??""),h(s.content??"")))},U=async()=>{if(i){if(c(""),!m?.trim()||m.trim().length<2){c("제목은 2자 이상 입력하세요.");return}if(!x?.trim()||x.trim().length<10){c("내용은 10자 이상 입력하세요.");return}S(!0);try{const t={id:Number(d),boardCategoryId:s?.boardCategoryId??3,title:m.trim(),content:x.trim(),isPublic:s?.isPublic??!0,requireAdminPost:s?.requireAdminPost??!1,qnaStatus:s?.qnaStatus??"WAITING",postStatus:s?.postStatus??"PUBLISHED"};await f.put(`/boards/update/${d}`,t),await F(),A(!1)}catch(t){console.error("PUT /boards/update error:",{status:t?.response?.status,data:t?.response?.data,message:t?.message}),c(t?.response?.data?.message??t?.response?.data?.error??"수정에 실패했습니다. 잠시 후 다시 시도하세요.")}finally{S(!1)}}},Q=async()=>{if(i&&confirm("정말 삭제하시겠습니까? (소프트 삭제)")){E(!0);try{const t=n?.id??n?.memberId??0;await f.delete(`/boards/delete/${d}`,{data:{requesterId:t,reason:"FAQ 삭제"}}),alert("삭제되었습니다."),I()}catch(t){console.error(t),alert("삭제에 실패했습니다.")}finally{E(!1)}}};return e.jsxs("section",{className:"w-full max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"FAQ"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"자주 묻는 질문 상세"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:I,className:"rounded-2xl px-4 py-2 shadow-sm ring-1 ring-gray-200 bg-white text-gray-700 hover:bg-gray-50 transition",children:"목록"}),i&&e.jsx(e.Fragment,{children:g?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:U,disabled:y,className:"rounded-2xl px-4 py-2 shadow-sm text-white bg-gradient-to-r from-pink-300 to-purple-300 hover:opacity-90 transition disabled:opacity-60",children:y?"저장 중…":"저장"}),e.jsx("button",{onClick:M,disabled:y,className:"rounded-2xl px-4 py-2 shadow-sm ring-1 ring-gray-200 bg-white text-gray-700 hover:bg-gray-50 transition disabled:opacity-60",children:"취소"})]}):e.jsx("button",{onClick:M,className:"rounded-2xl px-4 py-2 shadow-sm text-white bg-gradient-to-r from-pink-300 to-purple-300 hover:opacity-90 transition",children:"수정"})}),P&&i&&e.jsx("button",{onClick:Q,disabled:D,className:"rounded-2xl px-4 py-2 shadow-sm ring-1 ring-rose-200 bg-rose-50 text-rose-700 hover:bg-rose-100 transition disabled:opacity-60",children:D?"삭제 중…":"삭제"})]})]}),e.jsxs("div",{className:"rounded-3xl border border-gray-200 bg-white shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-5 md:px-6 py-5 border-b border-gray-100",children:j?e.jsx("div",{className:"h-6 w-2/3 bg-gray-100 rounded animate-pulse"}):u?e.jsx("p",{className:"text-sm text-rose-600",children:u}):e.jsxs(e.Fragment,{children:[g?i?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"제목"}),e.jsx("input",{type:"text",value:m,onChange:t=>p(t.target.value),className:"w-full rounded-xl border text-sm px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-200 border-gray-200",maxLength:160})]}):null:e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900 break-words",children:s?.title}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs ${T}`,children:s?.isPublic===!1?"비공개":"공개"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-gray-50 ring-1 ring-gray-200 text-gray-600",children:"FAQ"}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsxs("span",{className:"text-gray-600",children:["등록 ",k(s?.regDate)]}),s?.modDate&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsxs("span",{className:"text-gray-600",children:["수정 ",k(s?.modDate)]})]})]})]})}),e.jsx("div",{className:"px-5 md:px-6 py-6",children:j?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-100 rounded animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-100 rounded animate-pulse w-11/12"}),e.jsx("div",{className:"h-4 bg-gray-100 rounded animate-pulse w-10/12"}),e.jsx("div",{className:"h-4 bg-gray-100 rounded animate-pulse w-9/12"})]}):u?e.jsx("p",{className:"text-sm text-rose-600",children:u}):g?i?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"내용"}),e.jsx("textarea",{value:x,onChange:t=>h(t.target.value),className:"w-full min-h-[220px] rounded-xl border text-sm px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-200 resize-y border-gray-200",placeholder:"수정할 내용을 입력하세요."}),C&&e.jsx("p",{className:"mt-2 text-sm text-rose-600",children:C})]}):null:e.jsx("article",{className:"prose prose-sm md:prose-base max-w-none text-gray-900 whitespace-pre-wrap break-words",children:s?.content})})]})]})}export{z as default};
