import{a as t,al as F,ao as e,an as x}from"./index-D3Bzzjcr.js";import{u as w,c as B,g as J,M as S}from"./healthScoreCalculator-CBAA5TLi.js";const D={gender:"",smoking:!1,drinking:!1,drinkingPerWeek:"",drinkingPerOnce:"",drinkingType:"",drinkingUnit:"",chronicDiseaseYn:!1,chronicDiseaseIds:[],allergyYn:!1,allergyIds:[],medicationYn:!1,medicationIds:[],medications:[],searchKeyword:"",height:"",weight:"",bloodPressureSystolic:"",bloodPressureDiastolic:"",bloodSugar:"",sleepHours:"",birthDate:"",age:"",ageGroup:""};function V(){const[n,a]=t.useState(D),[b,C]=t.useState([]),[j,I]=t.useState([]),[y,f]=t.useState(""),[v,N]=t.useState([]),[g,k]=t.useState(!1),[o,P]=t.useState({}),p=t.useRef(null),Y=F(),[E,T]=t.useState(0),[h,O]=t.useState({grade:"-",text:"-",color:"#gray"}),c=w(b),m=w(j),H=s=>{if(!s)return"";const r=new Date,l=new Date(s);let i=r.getFullYear()-l.getFullYear();const u=r.getMonth()-l.getMonth();return(u<0||u===0&&r.getDate()<l.getDate())&&i--,i},K=s=>s?s<10?"10ì„¸ ë¯¸ë§Œ":s<20?"10ëŒ€":s<30?"20ëŒ€":s<40?"30ëŒ€":s<50?"40ëŒ€":s<60?"50ëŒ€":s<70?"60ëŒ€":"70ëŒ€ ì´ìƒ":"";t.useEffect(()=>{const s=B(n),r=J(s);T(s),O(r)},[n]),t.useEffect(()=>{n.drinking||a(s=>({...s,drinkingType:"",drinkingUnit:"",drinkingPerWeek:"",drinkingPerOnce:""}))},[n.drinking]),t.useEffect(()=>{switch(n.drinkingType){case"SOJU":case"WINE":case"WHISKY":case"COCKTAIL":a(s=>({...s,drinkingUnit:"ì”"}));break;case"BEER":a(s=>({...s,drinkingUnit:"ìº”"}));break;case"MAKGEOLLI":a(s=>({...s,drinkingUnit:"ì»µ"}));break;default:a(s=>({...s,drinkingUnit:""}))}},[n.drinkingType]),t.useEffect(()=>{(async()=>{try{const[r,l]=await Promise.all([x.get("/health/condition/chronicDiseases"),x.get("/health/condition/allergies")]);C(r.data||[]),I(l.data||[])}catch(r){console.error("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨",r)}})()},[]);const d=s=>{const{name:r,value:l}=s.target,i={...n,[r]:l};if(r==="birthDate"){const u=H(l),R=K(u);i.age=u,i.ageGroup=R}a(i),P(S(i))},A=async s=>{if(!s.trim()){N([]);return}p.current&&clearTimeout(p.current),p.current=setTimeout(async()=>{try{const r=await x.get(`/health/medication/search?keyword=${s}`);N(Array.isArray(r.data)?r.data:[])}catch(r){console.error("ì•½í’ˆ ê²€ìƒ‰ ì‹¤íŒ¨:",r)}},300)},M=s=>{n.medications.some(r=>r.id===s.id)||a(r=>({...r,medications:[...r.medications,s]}))},L=s=>{a(r=>({...r,medications:r.medications.filter(l=>l.id!==s)}))},G=s=>{n.chronicDiseaseIds.includes(s.id)||(a(r=>({...r,chronicDiseaseIds:[...r.chronicDiseaseIds,s.id]})),c.reset())},U=s=>{n.allergyIds.includes(s.id)||(a(r=>({...r,allergyIds:[...r.allergyIds,s.id]})),m.reset())},W=async s=>{s.preventDefault();const r=S(n);if(Object.keys(r).length>0){alert(Object.values(r)[0]);return}if(!window.confirm("ê±´ê°•ì •ë³´ë¥¼ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))return;k(!0);const l={gender:n.gender,smoking:n.smoking,drinking:n.drinking,drinkingPerWeek:n.drinkingPerWeek,drinkingPerOnce:n.drinkingPerOnce,drinkingType:n.drinkingType,drinkingUnit:n.drinkingUnit,chronicDiseaseYn:n.chronicDiseaseYn,chronicDiseaseIds:n.chronicDiseaseIds,allergyYn:n.allergyYn,allergyIds:n.allergyIds,medicationYn:n.medicationYn,medicationIds:n.medications?.map(i=>i.id)||[],height:n.height,weight:n.weight,bloodPressureSystolic:n.bloodPressureSystolic,bloodPressureDiastolic:n.bloodPressureDiastolic,bloodSugar:n.bloodSugar,sleepHours:n.sleepHours,birthDate:n.birthDate};try{await x.post("/health/measurement",l),alert("ê±´ê°•ì •ë³´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!"),Y("/mycare/list"),a(D),f("")}catch(i){console.error("ì €ì¥ ì‹¤íŒ¨:",i),alert("ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.")}finally{k(!1)}};return e.jsxs("div",{className:"max-w-3xl mx-auto bg-white p-8 rounded-2xl shadow-md",children:[e.jsx("h1",{className:"text-3xl font-extrabold bg-gradient-to-r from-pink-400 to-purple-500 text-transparent bg-clip-text text-center mb-8",children:"ê±´ê°•ì •ë³´ ë“±ë¡"}),e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl border-2 border-purple-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1 font-semibold",children:"ì˜ˆìƒ ê±´ê°•ì ìˆ˜"}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("span",{className:"text-5xl font-bold",style:{color:h.color},children:E}),e.jsx("span",{className:"text-xl text-gray-500 mb-2",children:"ì "})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-4xl font-bold mb-1",style:{color:h.color},children:h.grade}),e.jsx("div",{className:"text-sm text-gray-600 font-semibold",children:h.text})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-purple-200",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx("span",{className:"text-base",children:"ğŸ’¡"}),e.jsx("span",{children:"ì…ë ¥ê°’ì´ ë³€ê²½ë˜ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì ìˆ˜ê°€ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤"})]})})]}),e.jsxs("form",{onSubmit:W,children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"ìƒë…„ì›”ì¼"}),e.jsx("input",{type:"date",name:"birthDate",value:n.birthDate||"",onChange:d,className:"mt-2 w-full border rounded-lg px-3 py-2"}),(n.age||n.ageGroup)&&e.jsxs("p",{className:"text-gray-600 text-sm mt-1",children:["ë‚˜ì´: ",e.jsx("span",{className:"font-medium",children:n.age||"-"}),"ì„¸ / ì—°ë ¹ëŒ€:"," ",e.jsx("span",{className:"font-medium",children:n.ageGroup||"-"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"ì„±ë³„"}),e.jsxs("select",{name:"gender",value:n.gender||"",onChange:d,required:!0,className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"ì„ íƒ"}),e.jsx("option",{value:"MALE",children:"ë‚¨ì„±"}),e.jsx("option",{value:"FEMALE",children:"ì—¬ì„±"}),e.jsx("option",{value:"OTHER",children:"ê¸°íƒ€"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"í¡ì—° ì—¬ë¶€"}),e.jsxs("select",{name:"smoking",value:String(n.smoking),onChange:s=>a({...n,smoking:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"ì•„ë‹ˆì˜¤"}),e.jsx("option",{value:"true",children:"ì˜ˆ"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"ìŒì£¼ ì—¬ë¶€"}),e.jsxs("select",{name:"drinking",value:String(n.drinking),onChange:s=>a({...n,drinking:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"ì•„ë‹ˆì˜¤"}),e.jsx("option",{value:"true",children:"ì˜ˆ"})]})]}),n.drinking&&e.jsxs("div",{className:"space-y-4 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"ì£¼ì¢… ì„ íƒ"}),e.jsxs("select",{name:"drinkingType",value:n.drinkingType,onChange:s=>a({...n,drinkingType:s.target.value}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"ì„ íƒ"}),e.jsx("option",{value:"SOJU",children:"ì†Œì£¼"}),e.jsx("option",{value:"BEER",children:"ë§¥ì£¼"}),e.jsx("option",{value:"WINE",children:"ì™€ì¸"}),e.jsx("option",{value:"WHISKY",children:"ìœ„ìŠ¤í‚¤"}),e.jsx("option",{value:"MAKGEOLLI",children:"ë§‰ê±¸ë¦¬"}),e.jsx("option",{value:"COCKTAIL",children:"ì¹µí…Œì¼"}),e.jsx("option",{value:"ETC",children:"ê¸°íƒ€"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"ì£¼ë‹¹ ìŒì£¼ íšŸìˆ˜"}),e.jsx("input",{type:"number",name:"drinkingPerWeek",value:n.drinkingPerWeek||"",onChange:d,placeholder:"íšŒ",step:"1",min:"0",className:"border rounded-lg px-3 py-2 w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block font-semibold",children:["1íšŒë‹¹ ìŒì£¼ëŸ‰ (",n.drinkingUnit||"ì”",")"]}),e.jsx("input",{type:"number",name:"drinkingPerOnce",value:n.drinkingPerOnce||"",onChange:d,placeholder:n.drinkingType==="BEER"?"ì˜ˆ: 3ìº” (500ml)":n.drinkingType==="SOJU"?"ì˜ˆ: ë°˜ë³‘~1ë³‘":n.drinkingType==="WINE"?"ì˜ˆ: 2ì”":n.drinkingType==="WHISKY"?"ì˜ˆ: 1ì”":n.drinkingType==="MAKGEOLLI"?"ì˜ˆ: 2ì»µ":n.drinkingType==="COCKTAIL"?"ì˜ˆ: 2ì”":"ì˜ˆ: 1íšŒë‹¹ ìŒì£¼ëŸ‰ ì…ë ¥",step:"1",min:"0",className:"border rounded-lg px-3 py-2 w-full"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"ê¸°ì €ì§ˆí™˜ ì—¬ë¶€"}),e.jsxs("select",{name:"chronicDiseaseYn",value:String(n.chronicDiseaseYn),onChange:s=>a({...n,chronicDiseaseYn:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"ì•„ë‹ˆì˜¤"}),e.jsx("option",{value:"true",children:"ì˜ˆ"})]}),n.chronicDiseaseYn&&e.jsxs("div",{className:"mt-3",children:[e.jsx("input",{type:"text",placeholder:"ê¸°ì €ì§ˆí™˜ ê²€ìƒ‰",value:c.keyword,onChange:s=>c.handleSearch(s.target.value),className:"border rounded-lg px-3 py-2 w-full"}),c.results.length>0&&e.jsx("ul",{className:"mt-2 border rounded-lg p-2 bg-gray-50 max-h-40 overflow-y-auto",children:c.results.map(s=>e.jsxs("li",{className:"cursor-pointer hover:text-pink-600 py-1",onClick:()=>G(s),children:["+ ",s.nameKo]},s.id))}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:n.chronicDiseaseIds.map(s=>{const r=b.find(l=>l.id===s);return e.jsxs("span",{className:"bg-blue-200 text-sm px-2 py-1 rounded flex items-center space-x-1",children:[r?.nameKo,e.jsx("button",{type:"button",onClick:()=>a(l=>({...l,chronicDiseaseIds:l.chronicDiseaseIds.filter(i=>i!==s)})),className:"text-red-500",children:"âœ•"})]},s)})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"ì•ŒëŸ¬ì§€ ì—¬ë¶€"}),e.jsxs("select",{name:"allergyYn",value:String(n.allergyYn),onChange:s=>a({...n,allergyYn:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"ì•„ë‹ˆì˜¤"}),e.jsx("option",{value:"true",children:"ì˜ˆ"})]}),n.allergyYn&&e.jsxs("div",{className:"mt-3",children:[e.jsx("input",{type:"text",placeholder:"ì•ŒëŸ¬ì§€ ê²€ìƒ‰",value:m.keyword,onChange:s=>m.handleSearch(s.target.value),className:"border rounded-lg px-3 py-2 w-full"}),m.results.length>0&&e.jsx("ul",{className:"mt-2 border rounded-lg p-2 bg-gray-50 max-h-40 overflow-y-auto",children:m.results.map(s=>e.jsxs("li",{className:"cursor-pointer hover:text-pink-600 py-1",onClick:()=>U(s),children:["+ ",s.nameKo]},s.id))}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:n.allergyIds.map(s=>{const r=j.find(l=>l.id===s);return e.jsxs("span",{className:"bg-green-200 text-sm px-2 py-1 rounded flex items-center space-x-1",children:[r?.nameKo,e.jsx("button",{type:"button",onClick:()=>a(l=>({...l,allergyIds:l.allergyIds.filter(i=>i!==s)})),className:"text-red-500",children:"âœ•"})]},s)})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"ë³µìš©ì•½ ì—¬ë¶€"}),e.jsxs("select",{name:"medicationYn",value:String(n.medicationYn),onChange:s=>a({...n,medicationYn:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"ì•„ë‹ˆì˜¤"}),e.jsx("option",{value:"true",children:"ì˜ˆ"})]}),n.medicationYn&&e.jsxs("div",{className:"mt-3",children:[e.jsx("input",{type:"text",placeholder:"ë³µìš©ì•½ ê²€ìƒ‰",value:y,onChange:s=>{f(s.target.value),A(s.target.value)},className:"border rounded-lg px-3 py-2 w-full"}),y.length>0&&v.length>0&&e.jsx("ul",{className:"mt-2 border rounded-lg p-2 bg-gray-50 max-h-40 overflow-y-auto",children:v.map(s=>e.jsxs("li",{className:"cursor-pointer hover:text-pink-600 py-1",onClick:()=>M(s),children:["+ ",s.nameKo," ",s.company&&`(${s.company})`]},s.id))}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:n.medications.map(s=>e.jsxs("span",{className:"bg-purple-200 text-sm px-2 py-1 rounded flex items-center space-x-1",children:[s.nameKo,e.jsx("button",{type:"button",onClick:()=>L(s.id),className:"text-red-500",children:"âœ•"})]},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"í‚¤ (cm)"}),e.jsx("input",{type:"number",name:"height",value:n.height||"",onChange:d,placeholder:"ì˜ˆ: 165",step:"1",min:"0",max:"300",className:"border rounded-lg px-3 py-2 w-full"}),o.height&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.height})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"ì²´ì¤‘ (kg)"}),e.jsx("input",{type:"number",name:"weight",value:n.weight||"",onChange:d,placeholder:"ì˜ˆ: 60",step:"1",min:"0",max:"500",className:"border rounded-lg px-3 py-2 w-full"}),o.weight&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.weight})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"ìˆ˜ì¶•ê¸° í˜ˆì••(mmHg)"}),e.jsx("input",{type:"number",name:"bloodPressureSystolic",value:n.bloodPressureSystolic||"",onChange:d,placeholder:"ì˜ˆ: 120",step:"1",min:"0",max:"300",className:"border rounded-lg px-3 py-2 w-full"}),o.bloodPressureSystolic&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.bloodPressureSystolic})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"ì´ì™„ê¸° í˜ˆì••(mmHg)"}),e.jsx("input",{type:"number",name:"bloodPressureDiastolic",value:n.bloodPressureDiastolic||"",onChange:d,placeholder:"ì˜ˆ: 80",step:"1",min:"0",max:"200",className:"border rounded-lg px-3 py-2 w-full"}),o.bloodPressureDiastolic&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.bloodPressureDiastolic})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"í˜ˆë‹¹ (mg/dL)"}),e.jsx("input",{type:"number",name:"bloodSugar",value:n.bloodSugar||"",onChange:d,placeholder:"ì˜ˆ: 90",step:"1",min:"0",max:"600",className:"border rounded-lg px-3 py-2 w-full"}),o.bloodSugar&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.bloodSugar})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"ìˆ˜ë©´ ì‹œê°„ (ì‹œê°„)"}),e.jsx("input",{type:"number",name:"sleepHours",value:n.sleepHours||"",onChange:d,placeholder:"ì˜ˆ: 7",step:"0.5",min:"0",max:"24",className:"border rounded-lg px-3 py-2 w-full"}),o.sleepHours&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.sleepHours})]})]}),e.jsx("div",{className:"flex justify-center mt-10",children:e.jsx("button",{type:"submit",disabled:g,className:`px-6 py-2 rounded-lg text-white font-semibold bg-gradient-to-r from-pink-400 to-purple-500 hover:opacity-90 transition ${g?"opacity-50 cursor-not-allowed":""}`,children:g?"ë“±ë¡ ì¤‘...":"ë“±ë¡"})})]})]})}export{V as default};
