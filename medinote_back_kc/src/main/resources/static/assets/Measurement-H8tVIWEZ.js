import{a as t,al as F,ao as e,an as x}from"./index-D3Bzzjcr.js";import{u as w,c as B,g as J,M as S}from"./healthScoreCalculator-CBAA5TLi.js";const D={gender:"",smoking:!1,drinking:!1,drinkingPerWeek:"",drinkingPerOnce:"",drinkingType:"",drinkingUnit:"",chronicDiseaseYn:!1,chronicDiseaseIds:[],allergyYn:!1,allergyIds:[],medicationYn:!1,medicationIds:[],medications:[],searchKeyword:"",height:"",weight:"",bloodPressureSystolic:"",bloodPressureDiastolic:"",bloodSugar:"",sleepHours:"",birthDate:"",age:"",ageGroup:""};function V(){const[n,a]=t.useState(D),[b,C]=t.useState([]),[j,I]=t.useState([]),[y,f]=t.useState(""),[v,N]=t.useState([]),[g,k]=t.useState(!1),[o,P]=t.useState({}),p=t.useRef(null),Y=F(),[E,T]=t.useState(0),[h,O]=t.useState({grade:"-",text:"-",color:"#gray"}),c=w(b),m=w(j),H=s=>{if(!s)return"";const r=new Date,l=new Date(s);let i=r.getFullYear()-l.getFullYear();const u=r.getMonth()-l.getMonth();return(u<0||u===0&&r.getDate()<l.getDate())&&i--,i},K=s=>s?s<10?"10세 미만":s<20?"10대":s<30?"20대":s<40?"30대":s<50?"40대":s<60?"50대":s<70?"60대":"70대 이상":"";t.useEffect(()=>{const s=B(n),r=J(s);T(s),O(r)},[n]),t.useEffect(()=>{n.drinking||a(s=>({...s,drinkingType:"",drinkingUnit:"",drinkingPerWeek:"",drinkingPerOnce:""}))},[n.drinking]),t.useEffect(()=>{switch(n.drinkingType){case"SOJU":case"WINE":case"WHISKY":case"COCKTAIL":a(s=>({...s,drinkingUnit:"잔"}));break;case"BEER":a(s=>({...s,drinkingUnit:"캔"}));break;case"MAKGEOLLI":a(s=>({...s,drinkingUnit:"컵"}));break;default:a(s=>({...s,drinkingUnit:""}))}},[n.drinkingType]),t.useEffect(()=>{(async()=>{try{const[r,l]=await Promise.all([x.get("/health/condition/chronicDiseases"),x.get("/health/condition/allergies")]);C(r.data||[]),I(l.data||[])}catch(r){console.error("데이터 로딩 실패",r)}})()},[]);const d=s=>{const{name:r,value:l}=s.target,i={...n,[r]:l};if(r==="birthDate"){const u=H(l),R=K(u);i.age=u,i.ageGroup=R}a(i),P(S(i))},A=async s=>{if(!s.trim()){N([]);return}p.current&&clearTimeout(p.current),p.current=setTimeout(async()=>{try{const r=await x.get(`/health/medication/search?keyword=${s}`);N(Array.isArray(r.data)?r.data:[])}catch(r){console.error("약품 검색 실패:",r)}},300)},M=s=>{n.medications.some(r=>r.id===s.id)||a(r=>({...r,medications:[...r.medications,s]}))},L=s=>{a(r=>({...r,medications:r.medications.filter(l=>l.id!==s)}))},G=s=>{n.chronicDiseaseIds.includes(s.id)||(a(r=>({...r,chronicDiseaseIds:[...r.chronicDiseaseIds,s.id]})),c.reset())},U=s=>{n.allergyIds.includes(s.id)||(a(r=>({...r,allergyIds:[...r.allergyIds,s.id]})),m.reset())},W=async s=>{s.preventDefault();const r=S(n);if(Object.keys(r).length>0){alert(Object.values(r)[0]);return}if(!window.confirm("건강정보를 등록하시겠습니까?"))return;k(!0);const l={gender:n.gender,smoking:n.smoking,drinking:n.drinking,drinkingPerWeek:n.drinkingPerWeek,drinkingPerOnce:n.drinkingPerOnce,drinkingType:n.drinkingType,drinkingUnit:n.drinkingUnit,chronicDiseaseYn:n.chronicDiseaseYn,chronicDiseaseIds:n.chronicDiseaseIds,allergyYn:n.allergyYn,allergyIds:n.allergyIds,medicationYn:n.medicationYn,medicationIds:n.medications?.map(i=>i.id)||[],height:n.height,weight:n.weight,bloodPressureSystolic:n.bloodPressureSystolic,bloodPressureDiastolic:n.bloodPressureDiastolic,bloodSugar:n.bloodSugar,sleepHours:n.sleepHours,birthDate:n.birthDate};try{await x.post("/health/measurement",l),alert("건강정보가 등록되었습니다!"),Y("/mycare/list"),a(D),f("")}catch(i){console.error("저장 실패:",i),alert("저장에 실패했습니다. 다시 시도해주세요.")}finally{k(!1)}};return e.jsxs("div",{className:"max-w-3xl mx-auto bg-white p-8 rounded-2xl shadow-md",children:[e.jsx("h1",{className:"text-3xl font-extrabold bg-gradient-to-r from-pink-400 to-purple-500 text-transparent bg-clip-text text-center mb-8",children:"건강정보 등록"}),e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl border-2 border-purple-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1 font-semibold",children:"예상 건강점수"}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("span",{className:"text-5xl font-bold",style:{color:h.color},children:E}),e.jsx("span",{className:"text-xl text-gray-500 mb-2",children:"점"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-4xl font-bold mb-1",style:{color:h.color},children:h.grade}),e.jsx("div",{className:"text-sm text-gray-600 font-semibold",children:h.text})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-purple-200",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx("span",{className:"text-base",children:"💡"}),e.jsx("span",{children:"입력값이 변경되면 실시간으로 점수가 업데이트됩니다"})]})})]}),e.jsxs("form",{onSubmit:W,children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"생년월일"}),e.jsx("input",{type:"date",name:"birthDate",value:n.birthDate||"",onChange:d,className:"mt-2 w-full border rounded-lg px-3 py-2"}),(n.age||n.ageGroup)&&e.jsxs("p",{className:"text-gray-600 text-sm mt-1",children:["나이: ",e.jsx("span",{className:"font-medium",children:n.age||"-"}),"세 / 연령대:"," ",e.jsx("span",{className:"font-medium",children:n.ageGroup||"-"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"성별"}),e.jsxs("select",{name:"gender",value:n.gender||"",onChange:d,required:!0,className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"MALE",children:"남성"}),e.jsx("option",{value:"FEMALE",children:"여성"}),e.jsx("option",{value:"OTHER",children:"기타"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"흡연 여부"}),e.jsxs("select",{name:"smoking",value:String(n.smoking),onChange:s=>a({...n,smoking:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"아니오"}),e.jsx("option",{value:"true",children:"예"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"음주 여부"}),e.jsxs("select",{name:"drinking",value:String(n.drinking),onChange:s=>a({...n,drinking:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"아니오"}),e.jsx("option",{value:"true",children:"예"})]})]}),n.drinking&&e.jsxs("div",{className:"space-y-4 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"주종 선택"}),e.jsxs("select",{name:"drinkingType",value:n.drinkingType,onChange:s=>a({...n,drinkingType:s.target.value}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"SOJU",children:"소주"}),e.jsx("option",{value:"BEER",children:"맥주"}),e.jsx("option",{value:"WINE",children:"와인"}),e.jsx("option",{value:"WHISKY",children:"위스키"}),e.jsx("option",{value:"MAKGEOLLI",children:"막걸리"}),e.jsx("option",{value:"COCKTAIL",children:"칵테일"}),e.jsx("option",{value:"ETC",children:"기타"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"주당 음주 횟수"}),e.jsx("input",{type:"number",name:"drinkingPerWeek",value:n.drinkingPerWeek||"",onChange:d,placeholder:"회",step:"1",min:"0",className:"border rounded-lg px-3 py-2 w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block font-semibold",children:["1회당 음주량 (",n.drinkingUnit||"잔",")"]}),e.jsx("input",{type:"number",name:"drinkingPerOnce",value:n.drinkingPerOnce||"",onChange:d,placeholder:n.drinkingType==="BEER"?"예: 3캔 (500ml)":n.drinkingType==="SOJU"?"예: 반병~1병":n.drinkingType==="WINE"?"예: 2잔":n.drinkingType==="WHISKY"?"예: 1잔":n.drinkingType==="MAKGEOLLI"?"예: 2컵":n.drinkingType==="COCKTAIL"?"예: 2잔":"예: 1회당 음주량 입력",step:"1",min:"0",className:"border rounded-lg px-3 py-2 w-full"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"기저질환 여부"}),e.jsxs("select",{name:"chronicDiseaseYn",value:String(n.chronicDiseaseYn),onChange:s=>a({...n,chronicDiseaseYn:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"아니오"}),e.jsx("option",{value:"true",children:"예"})]}),n.chronicDiseaseYn&&e.jsxs("div",{className:"mt-3",children:[e.jsx("input",{type:"text",placeholder:"기저질환 검색",value:c.keyword,onChange:s=>c.handleSearch(s.target.value),className:"border rounded-lg px-3 py-2 w-full"}),c.results.length>0&&e.jsx("ul",{className:"mt-2 border rounded-lg p-2 bg-gray-50 max-h-40 overflow-y-auto",children:c.results.map(s=>e.jsxs("li",{className:"cursor-pointer hover:text-pink-600 py-1",onClick:()=>G(s),children:["+ ",s.nameKo]},s.id))}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:n.chronicDiseaseIds.map(s=>{const r=b.find(l=>l.id===s);return e.jsxs("span",{className:"bg-blue-200 text-sm px-2 py-1 rounded flex items-center space-x-1",children:[r?.nameKo,e.jsx("button",{type:"button",onClick:()=>a(l=>({...l,chronicDiseaseIds:l.chronicDiseaseIds.filter(i=>i!==s)})),className:"text-red-500",children:"✕"})]},s)})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"알러지 여부"}),e.jsxs("select",{name:"allergyYn",value:String(n.allergyYn),onChange:s=>a({...n,allergyYn:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"아니오"}),e.jsx("option",{value:"true",children:"예"})]}),n.allergyYn&&e.jsxs("div",{className:"mt-3",children:[e.jsx("input",{type:"text",placeholder:"알러지 검색",value:m.keyword,onChange:s=>m.handleSearch(s.target.value),className:"border rounded-lg px-3 py-2 w-full"}),m.results.length>0&&e.jsx("ul",{className:"mt-2 border rounded-lg p-2 bg-gray-50 max-h-40 overflow-y-auto",children:m.results.map(s=>e.jsxs("li",{className:"cursor-pointer hover:text-pink-600 py-1",onClick:()=>U(s),children:["+ ",s.nameKo]},s.id))}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:n.allergyIds.map(s=>{const r=j.find(l=>l.id===s);return e.jsxs("span",{className:"bg-green-200 text-sm px-2 py-1 rounded flex items-center space-x-1",children:[r?.nameKo,e.jsx("button",{type:"button",onClick:()=>a(l=>({...l,allergyIds:l.allergyIds.filter(i=>i!==s)})),className:"text-red-500",children:"✕"})]},s)})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"복용약 여부"}),e.jsxs("select",{name:"medicationYn",value:String(n.medicationYn),onChange:s=>a({...n,medicationYn:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"아니오"}),e.jsx("option",{value:"true",children:"예"})]}),n.medicationYn&&e.jsxs("div",{className:"mt-3",children:[e.jsx("input",{type:"text",placeholder:"복용약 검색",value:y,onChange:s=>{f(s.target.value),A(s.target.value)},className:"border rounded-lg px-3 py-2 w-full"}),y.length>0&&v.length>0&&e.jsx("ul",{className:"mt-2 border rounded-lg p-2 bg-gray-50 max-h-40 overflow-y-auto",children:v.map(s=>e.jsxs("li",{className:"cursor-pointer hover:text-pink-600 py-1",onClick:()=>M(s),children:["+ ",s.nameKo," ",s.company&&`(${s.company})`]},s.id))}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:n.medications.map(s=>e.jsxs("span",{className:"bg-purple-200 text-sm px-2 py-1 rounded flex items-center space-x-1",children:[s.nameKo,e.jsx("button",{type:"button",onClick:()=>L(s.id),className:"text-red-500",children:"✕"})]},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"키 (cm)"}),e.jsx("input",{type:"number",name:"height",value:n.height||"",onChange:d,placeholder:"예: 165",step:"1",min:"0",max:"300",className:"border rounded-lg px-3 py-2 w-full"}),o.height&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.height})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"체중 (kg)"}),e.jsx("input",{type:"number",name:"weight",value:n.weight||"",onChange:d,placeholder:"예: 60",step:"1",min:"0",max:"500",className:"border rounded-lg px-3 py-2 w-full"}),o.weight&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.weight})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"수축기 혈압(mmHg)"}),e.jsx("input",{type:"number",name:"bloodPressureSystolic",value:n.bloodPressureSystolic||"",onChange:d,placeholder:"예: 120",step:"1",min:"0",max:"300",className:"border rounded-lg px-3 py-2 w-full"}),o.bloodPressureSystolic&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.bloodPressureSystolic})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"이완기 혈압(mmHg)"}),e.jsx("input",{type:"number",name:"bloodPressureDiastolic",value:n.bloodPressureDiastolic||"",onChange:d,placeholder:"예: 80",step:"1",min:"0",max:"200",className:"border rounded-lg px-3 py-2 w-full"}),o.bloodPressureDiastolic&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.bloodPressureDiastolic})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"혈당 (mg/dL)"}),e.jsx("input",{type:"number",name:"bloodSugar",value:n.bloodSugar||"",onChange:d,placeholder:"예: 90",step:"1",min:"0",max:"600",className:"border rounded-lg px-3 py-2 w-full"}),o.bloodSugar&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.bloodSugar})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"수면 시간 (시간)"}),e.jsx("input",{type:"number",name:"sleepHours",value:n.sleepHours||"",onChange:d,placeholder:"예: 7",step:"0.5",min:"0",max:"24",className:"border rounded-lg px-3 py-2 w-full"}),o.sleepHours&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.sleepHours})]})]}),e.jsx("div",{className:"flex justify-center mt-10",children:e.jsx("button",{type:"submit",disabled:g,className:`px-6 py-2 rounded-lg text-white font-semibold bg-gradient-to-r from-pink-400 to-purple-500 hover:opacity-90 transition ${g?"opacity-50 cursor-not-allowed":""}`,children:g?"등록 중...":"등록"})})]})]})}export{V as default};
