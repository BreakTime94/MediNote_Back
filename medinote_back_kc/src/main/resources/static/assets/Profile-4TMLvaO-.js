import{a as r,ao as e,an as g,am as T,al as M}from"./index-D3Bzzjcr.js";import{s as x}from"./commonToast-eM_n8a5E.js";import{u as P}from"./useEmailTimer-DN5LH1mw.js";import{U as I}from"./UseDuplicateCheck-CCrvuKal.js";function A({member:t,setMember:n,touched:u,errors:l,emailStatus:m,handleBlur:V,change:S,verification:c,setVerification:E}){const[o,j]=r.useState(""),[v,p]=r.useState(!1),{leftTime:y,startTimer:b,formatTime:N,stopTimer:f}=P(),k=()=>{g.post("/member/email/send",{email:t.extraEmail,type:"extraEmailVerify"}).then(i=>{x.success({title:i.data.message,desc:i.data.desc}),p(!0),b()}).catch(()=>{x.error({title:"인증 메일 발송에 실패했습니다.",desc:"잠시 후 다시 시도하여주시기 바랍니다."})})},w=()=>{g.post("/member/email/verify",{email:t.extraEmail,code:o,type:"extraEmailVerify"},{withCredentials:!0}).then(i=>{if(i.data.available===!0){x.success({title:i.data.message}),n(h=>({...h,extraEmailVerified:!0}));const D={...t,extraEmailVerified:!0};g.patch("/member/modify",D,{withCredentials:!0}).then(h=>{console.log("update 완료",h)}).catch(()=>{x.error({title:"알수 없는 오류로 인증이 반영되지 않았습니다."})}),E(!0),p(!1),f()}else x.formerr({title:"인증 코드가 올바르지 않습니다."})}).catch(()=>{x.error({title:"인증 확인 중 오류가 발생했습니다."})})};return e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"이메일"}),e.jsx("input",{id:"extraEmail",name:"extraEmail",className:"w-full px-3 py-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 disabled:bg-gray-100",placeholder:"추가 이메일을 입력하세요",onBlur:V,onChange:i=>{S(i),E(!1),p(!1)},value:t.extraEmail,disabled:c||t.extraEmailVerified}),e.jsx("span",{className:t.extraEmailVerified?"text-xs text-blue-500 my-auto font-bold":"text-xs text-gray-500 my-auto font-bold",children:t.extraEmailVerified?"추가 이메일 인증이 완료되었습니다.":"추가 이메일 인증이 필요합니다."}),!l.extraEmail&&m==="available"&&t.email!==t.extraEmail&&!t.extraEmailVerified&&e.jsx("button",{type:"button",className:"mt-2 w-full px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",onClick:k,children:"인증메일 요청"}),v&&!c&&e.jsxs("div",{className:"mt-2 flex space-x-2",children:[e.jsx("input",{type:"text",name:"verificationCode",placeholder:"인증코드 입력",className:"flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400  disabled:bg-gray-200",disabled:c,value:o,onChange:i=>j(i.target.value)}),y&&e.jsx("span",{className:"text-xs text-gray-500 my-auto font-bold",children:N(y)}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:bg-amber-100",disabled:c,onClick:w,children:"확인"})]}),u.extraEmail&&l.extraEmail&&e.jsx("ul",{className:"mt-2 text-xs",children:e.jsx("li",{className:"text-red-500",children:l.extraEmail})}),u.extraEmail&&!l.extraEmail&&m!=="idle"&&t.email!==t.extraEmail&&!t.extraEmailVerified&&e.jsx("ul",{className:"mt-2 text-xs",children:e.jsx("li",{className:m==="available"?"text-blue-500":"text-red-500",children:m==="available"?"사용 가능한 이메일입니다.":"사용하실 수 없는 이메일입니다."})}),u.extraEmail&&!l.extraEmail&&t.extraEmail&&t.email===t.extraEmail&&e.jsx("ul",{className:"mt-2 text-xs",children:e.jsx("li",{className:"text-red-500",children:"추가 이메일과 같은 이메일을 사용하실 수 없습니다."})})]})}function $(){const{setMember:t}=T.getState(),[n,u]=r.useState({email:"",nickname:"",extraEmail:"",profileImagePath:"",extraEmailVerified:null,regDate:""}),[l,m]=r.useState({extraEmail:"",nickname:"",profileImagePath:"",profileMimeType:"",extraEmailVerified:null}),[V,S]=r.useState(!1),[c,E]=r.useState({extraEmail:!1,nickname:!1}),[o,j]=r.useState({}),v=a=>{const{name:s,value:C}=a.target;E(d=>({...d,[s]:!0})),j(d=>({...d,[s]:b(s,C)}))},[p,y]=r.useState(!1),b=(a,s)=>{switch(a){case"extraEmail":if(!s)return"추가 이메일은 필수입니다.";if(!/^(?!.*\s)[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(s))return"문자 내 공백은 불가하며, 올바른 이메일 형식이어야 합니다. ex) aaa@bbb.ccc 등";break;case"nickname":if(!s)return"닉네임은 필수입니다.";if(!/^(?!.*\s)[가-힣a-zA-Z0-9]{2,16}$/.test(s))return"문자 내 공백은 불가하며, 닉네임은 한글, 영문, 숫자만 사용하여 2~16자까지 가능합니다.";break;default:return""}return""},N=I("email",l.extraEmail,"/member/check/email",b),f=I("nickname",l.nickname,"/member/check/nickname",b),k=M();r.useEffect(()=>{g.get("/member/get",{withCredentials:!0}).then(a=>{console.log("Content-Type",a.headers["content-type"]),console.log("로그인 된 멤버 정보",a.data),u(a.data.member),m(a.data.member)}).catch(a=>{console.log("error : ",a)})},[]),r.useEffect(()=>{const a=l.extraEmail!==n.extraEmail||l.nickname!==n.nickname||l.profileImagePath!==n.profileImagePath;y(a)},[l]);const w=a=>{const{name:s,value:C}=a.target;m(d=>({...d,[s]:C})),j(d=>({...d,[s]:b(s,C)}))},i=a=>{a.preventDefault(),g.patch("/member/modify",l).then(s=>{console.log(s),y(!1),t(l),u(l),k("/member/mypage")}).catch(s=>{console.log(s)})},D=a=>{window.confirm("정말 삭제하시겠습니까?")&&(a.preventDefault(),g.delete("/member/remove",{data:{email:n.email}}).then(s=>{console.log(s),t(null),localStorage.removeItem("auth-storage"),k("/")}).catch(()=>{x.error({title:"오류가 발생하였습니다."})}))},h=Object.values(o).some(a=>a.length>0)||N!=="available"||f!=="available"||!p;return e.jsx(e.Fragment,{children:n&&e.jsx("div",{className:"flex flex-col items-center justify-center bg-white",children:e.jsxs("div",{className:"mb-4 border-1 rounded-2xl p-8 w-full",children:[e.jsx("div",{className:"w-full mb-4",children:e.jsx("h3",{className:"font-bold",children:"회원정보"})}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"아이디"}),e.jsx("input",{className:"px-3 py-1 border rounded-lg w-full",name:"email",id:"email",value:n.email,readOnly:!0})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"닉네임"}),e.jsx("input",{className:"px-3 py-1 border rounded-lg w-full",name:"nickname",id:"nickname",value:l.nickname,onChange:w,onBlur:v})]}),c.nickname&&o.nickname&&e.jsx("ul",{className:"mt-2 text-xs",children:e.jsx("li",{className:"text-red-500",children:o.nickname})}),c.nickname&&!o.nickname&&f!=="idle"&&e.jsx("ul",{className:"mt-2 text-xs",children:e.jsx("li",{className:f==="available"?"text-blue-500":"text-red-500",children:f==="available"?"사용 가능한 닉네임입니다.":"사용하실 수 없는 닉네임입니다."})}),e.jsx(A,{member:l,setMember:m,touched:c,errors:o,emailStatus:N,handleBlur:v,change:w,verification:V,setVerification:S}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"프로필이미지"}),e.jsx("input",{className:"px-3 py-1 border rounded-lg w-full",name:"profileImagePath",value:l.profileImagePath||"이미지가 없습니다.",readOnly:!0})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"계정등록일"}),e.jsx("input",{className:"px-3 py-1 border rounded-lg w-full",name:"regDate",value:n.regDate,readOnly:!0})]}),e.jsxs("div",{className:"m-2 text-sm flex",children:[e.jsx("button",{type:"button",className:h===!1?"flex-1 bg-purple-300 text-gray-700 px-2 py-1 rounded-lg shadow hover:bg-purple-400 active:bg-purple-500 cursor-pointer":"flex-1 bg-gray-300 text-amber-50 px-2 py-1 rounded-lg shadow mx-2",onClick:i,disabled:h,children:"수정하기"}),e.jsx("button",{type:"button",className:"flex-1 bg-red-300 text-black px-2 py-1 rounded-lg shadow hover:bg-red-500 hover:font-bold cursor-pointer",onClick:D,children:"계정 탈퇴하기"})]})]})})})}export{$ as default};
