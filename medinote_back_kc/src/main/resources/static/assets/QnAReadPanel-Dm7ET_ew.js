import{am as W,a as r,ao as e,an as c,aJ as H,al as U}from"./index-D3Bzzjcr.js";function J({linkId:d,onAnswerComplete:I}){const{member:k}=W(),[m,M]=r.useState([]),[x,s]=r.useState(""),[A,b]=r.useState(!1),[f,g]=r.useState(!1),[N,p]=r.useState(""),[q,j]=r.useState({}),w=k?.role==="ADMIN",h=20,S=async()=>{try{const o=(await c.get("/member/list/info")).data?.memberInfoList??[],i={};o.forEach(E=>i[E.nickname]=E.id),j(i)}catch(a){console.error("회원 목록 불러오기 실패:",a)}},u=async()=>{if(d){b(!0);try{const a=await c.post(`/replies/list/BOARD/${d}`,{page:1,size:h});M(a.data?.content??[])}catch(a){console.error("댓글 목록 조회 실패:",a),p("댓글을 불러올 수 없습니다.")}finally{b(!1)}}},v=async a=>{if(a.preventDefault(),!x.trim()){alert("내용을 입력하세요.");return}const o=q[k?.nickname];if(!o){alert("회원 ID를 찾을 수 없습니다. 다시 로그인 후 시도해주세요.");return}g(!0);try{const i={memberId:o,linkId:d,linkType:"BOARD",content:x.trim(),isPublic:!0,title:"관리자 답변"};await c.post("/replies/create",i),await u(),s(""),I?I("ANSWERED"):await c.put(`/boards/qna/status/${d}`,{qnaStatus:"ANSWERED"}),alert("답변이 등록되었습니다.")}catch(i){console.error("댓글 등록 실패:",i),alert("댓글 등록 중 오류가 발생했습니다.")}finally{g(!1)}},D=async a=>{if(confirm("이 댓글을 삭제하시겠습니까?"))try{await c.delete(`/replies/delete/${a}`),await u()}catch(o){console.error("댓글 삭제 실패:",o),alert("댓글 삭제 중 오류가 발생했습니다.")}};return r.useEffect(()=>{S()},[]),r.useEffect(()=>{u()},[d]),e.jsxs("div",{className:"mt-10 rounded-3xl border border-gray-200 bg-white shadow-sm",children:[e.jsx("div",{className:"px-5 py-4 border-b border-gray-100",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"답변 / 댓글"})}),e.jsxs("div",{className:"p-5 space-y-6",children:[w&&e.jsxs("form",{onSubmit:v,className:"space-y-3",children:[e.jsx("textarea",{value:x,onChange:a=>s(a.target.value),placeholder:"답변 내용을 입력하세요.",className:"w-full rounded-xl border border-gray-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-200 min-h-[100px]"}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:f,className:"px-4 py-2 rounded-xl text-white bg-gradient-to-r from-pink-300 to-purple-300 hover:opacity-90 disabled:opacity-60",children:f?"등록 중…":"답변 등록"})})]}),A?e.jsx("p",{className:"text-sm text-gray-400",children:"댓글을 불러오는 중..."}):N?e.jsx("p",{className:"text-sm text-rose-600",children:N}):m.length===0?e.jsx("p",{className:"text-sm text-gray-400",children:"등록된 답변이 없습니다."}):e.jsx("ul",{className:"space-y-4",children:m.map(a=>e.jsxs("li",{className:"p-4 rounded-2xl border border-gray-100 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:a.memberNickname??"익명"}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(a.regDate).toLocaleString()})]}),w&&e.jsx("button",{onClick:()=>D(a.id),className:"text-xs text-rose-500 hover:text-rose-700",children:"삭제"})]}),e.jsx("p",{className:"text-sm text-gray-800 whitespace-pre-wrap",children:a.content})]},a.id))})]})]})}function _({onBack:d,onEdit:I,showAdminActions:k=!1}){const{id:m}=H(),M=U(),{member:x}=W(),[s,A]=r.useState(null),[b,f]=r.useState(!0),[g,N]=r.useState(""),[p,q]=r.useState({}),[j,w]=r.useState(!1),[h,S]=r.useState(""),[u,v]=r.useState(""),[D,a]=r.useState(!1),[o,i]=r.useState(""),[E,C]=r.useState(!1),F=r.useMemo(()=>s?s.qnaStatus==="ANSWERED"?"bg-green-50 text-green-700 ring-1 ring-green-200":s.qnaStatus==="WAITING"?"bg-amber-50 text-amber-700 ring-1 ring-amber-200":"bg-gray-50 text-gray-700 ring-1 ring-gray-200":"bg-gray-50 text-gray-700 ring-1 ring-gray-200",[s]),$=t=>{if(!t)return"-";try{const n=new Date(t),l=y=>String(y).padStart(2,"0");return`${n.getFullYear()}-${l(n.getMonth()+1)}-${l(n.getDate())} ${l(n.getHours())}:${l(n.getMinutes())}`}catch{return t}},R=()=>d?d():M("/boards/qna"),Q=async()=>{try{const n=(await c.get("/member/list/info")).data?.memberInfoList||[],l={};n.forEach(y=>l[y.id]=y.nickname),q(l)}catch(t){console.error("회원 목록 불러오기 실패:",t)}},P=async()=>{f(!0),N("");try{const t=await c.get(`/boards/read/${m}`);A(t.data||null),S(t.data?.title??""),v(t.data?.content??"")}catch(t){console.error(t),N("글을 불러오지 못했습니다.")}finally{f(!1)}};r.useEffect(()=>{Q(),P()},[m]);const L=(t,n)=>{if(!t)return null;if(t.id??t.memberId)return t.id??t.memberId;if(t.nickname&&n){const l=Object.entries(n).find(([,y])=>y===t.nickname);if(l)return Number(l[0])}return null},z=r.useMemo(()=>{if(!x||!s)return!1;const t=Number(L(x,p)),n=Number(s.memberId);return t===n},[x,s,p]),T=()=>{i(""),w(t=>!t),s&&(S(s.title??""),v(s.content??""))},B=async()=>{if(i(""),!h?.trim()||h.trim().length<2){i("제목은 2자 이상 입력하세요.");return}if(!u?.trim()||u.trim().length<10){i("내용은 10자 이상 입력하세요.");return}a(!0);try{const t={id:Number(m),boardCategoryId:s?.boardCategoryId??null,title:h.trim(),content:u.trim(),isPublic:s?.isPublic??!0,requireAdminPost:s?.requireAdminPost??!1,qnaStatus:s?.qnaStatus??"WAITING",postStatus:s?.postStatus??"PUBLISHED"};await c.put(`/boards/update/${m}`,t),await P(),w(!1)}catch(t){console.error("PUT /boards/update error:",t),i("수정에 실패했습니다. 잠시 후 다시 시도하세요.")}finally{a(!1)}},G=async()=>{if(confirm("정말 삭제하시겠습니까? (소프트 삭제)")){C(!0);try{await c.delete(`/boards/delete/${m}`,{data:{requesterId:L(x,p)??0,reason:"사용자 요청 삭제"}}),alert("삭제되었습니다."),R()}catch(t){console.error(t),alert("삭제에 실패했습니다.")}finally{C(!1)}}};return e.jsxs("section",{className:"w-full max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"QnA"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"질문 상세"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:R,className:"rounded-2xl px-4 py-2 shadow-sm ring-1 ring-gray-200 bg-white text-gray-700 hover:bg-gray-50 transition",children:"목록"}),z&&e.jsxs(e.Fragment,{children:[j?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:B,disabled:D,className:"rounded-2xl px-4 py-2 shadow-sm text-white bg-gradient-to-r from-pink-300 to-purple-300 hover:opacity-90 transition disabled:opacity-60",children:D?"저장 중…":"저장"}),e.jsx("button",{onClick:T,disabled:D,className:"rounded-2xl px-4 py-2 shadow-sm ring-1 ring-gray-200 bg-white text-gray-700 hover:bg-gray-50 transition disabled:opacity-60",children:"취소"})]}):e.jsx("button",{onClick:T,className:"rounded-2xl px-4 py-2 shadow-sm text-white bg-gradient-to-r from-pink-300 to-purple-300 hover:opacity-90 transition",children:"수정"}),e.jsx("button",{onClick:G,disabled:E,className:"rounded-2xl px-4 py-2 shadow-sm ring-1 ring-rose-200 bg-rose-50 text-rose-700 hover:bg-rose-100 transition disabled:opacity-60",children:E?"삭제 중…":"삭제"})]})]})]}),e.jsxs("div",{className:"rounded-3xl border border-gray-200 bg-white shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-5 md:px-6 py-5 border-b border-gray-100",children:b?e.jsx("div",{className:"h-6 w-2/3 bg-gray-100 rounded animate-pulse"}):g?e.jsx("p",{className:"text-sm text-rose-600",children:g}):e.jsxs(e.Fragment,{children:[j?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"제목"}),e.jsx("input",{type:"text",value:h,onChange:t=>S(t.target.value),className:"w-full rounded-xl border text-sm px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-200 border-gray-200",maxLength:120})]}):e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900 break-words",children:s?.title}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs ${F}`,children:s?.qnaStatus==="ANSWERED"?"답변완료":s?.qnaStatus==="WAITING"?"답변대기":s?.qnaStatus}),e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-gray-50 ring-1 ring-gray-200 text-gray-600",children:"QnA"}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsxs("span",{className:"text-gray-600",children:["등록 ",$(s?.regDate)]}),s?.memberId&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsxs("span",{className:"text-gray-600",children:["작성자: ",p[s.memberId]??"-"]})]}),s?.modDate&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsxs("span",{className:"text-gray-600",children:["수정 ",$(s?.modDate)]})]})]})]})}),e.jsx("div",{className:"px-5 md:px-6 py-6",children:b?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-100 rounded animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-100 rounded animate-pulse w-11/12"}),e.jsx("div",{className:"h-4 bg-gray-100 rounded animate-pulse w-10/12"})]}):g?e.jsx("p",{className:"text-sm text-rose-600",children:g}):j?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"내용"}),e.jsx("textarea",{value:u,onChange:t=>v(t.target.value),className:"w-full min-h-[220px] rounded-xl border text-sm px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-200 resize-y border-gray-200"}),o&&e.jsx("p",{className:"mt-2 text-sm text-rose-600",children:o})]}):e.jsx("article",{className:"prose prose-sm md:prose-base max-w-none text-gray-900 whitespace-pre-wrap break-words",children:s?.content})})]}),s?.id&&e.jsx(J,{linkId:s.id,onAnswerComplete:t=>{A(n=>({...n,qnaStatus:t}))}})]})}export{_ as default};
