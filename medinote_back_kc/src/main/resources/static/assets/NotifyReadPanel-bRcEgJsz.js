import{aJ as F,al as B,am as R,a as r,ao as e,an as b}from"./index-D3Bzzjcr.js";function G({onBack:f,showAdminActions:M=!0,listPath:$="/boards/notice"}){const{id:d}=F(),T=B(),{member:a}=R(),[s,U]=r.useState(null),[N,j]=r.useState(!0),[u,w]=r.useState(""),[m,v]=r.useState(!1),[x,p]=r.useState(""),[g,h]=r.useState(""),[y,S]=r.useState(!1),[D,c]=r.useState(""),[E,A]=r.useState(!1),i=r.useMemo(()=>{const t=(a?.role||a?.memberRole||a?.roleName||"")+"",n=Array.isArray(a?.roles)?a.roles:[],l=Array.isArray(a?.authorities)?a.authorities:[];return!!(t.toUpperCase()==="ADMIN"||n.map(o=>(o+"").toUpperCase()).includes("ADMIN")||l.some(o=>typeof o=="string"?o.toUpperCase().includes("ADMIN"):(o?.authority+"").toUpperCase().includes("ADMIN")))},[a]),L=r.useMemo(()=>{const t=s?.postStatus;return t==="PUBLISHED"?"bg-green-50 text-green-700 ring-1 ring-green-200":t==="HIDDEN"?"bg-gray-50 text-gray-700 ring-1 ring-gray-200":t==="DELETED"?"bg-rose-50 text-rose-700 ring-1 ring-rose-200":"bg-gray-50 text-gray-700 ring-1 ring-gray-200"},[s]),I=t=>{if(!t)return"-";try{const n=new Date(t);if(!isNaN(n.getTime())){const l=o=>String(o).padStart(2,"0");return`${n.getFullYear()}-${l(n.getMonth()+1)}-${l(n.getDate())} ${l(n.getHours())}:${l(n.getMinutes())}`}}catch{}return String(t).slice(0,16).replace("T"," ")},C=()=>f?f():T($),k=async()=>{j(!0),w("");try{const t=await b.get(`/boards/read/${d}`);U(t.data||null),p(t.data?.title??""),h(t.data?.content??"")}catch(t){console.error(t),w("공지를 불러오지 못했습니다.")}finally{j(!1)}};r.useEffect(()=>{k()},[d]);const P=()=>{i&&(c(""),v(t=>!t),s&&(p(s.title??""),h(s.content??"")))},q=async()=>{if(i){if(c(""),!x?.trim()||x.trim().length<2){c("제목은 2자 이상 입력하세요.");return}if(!g?.trim()||g.trim().length<10){c("내용은 10자 이상 입력하세요.");return}S(!0);try{const t={id:Number(d),boardCategoryId:s?.boardCategoryId??1,title:x.trim(),content:g.trim(),isPublic:s?.isPublic??!0,requireAdminPost:s?.requireAdminPost??!1,qnaStatus:s?.qnaStatus??"WAITING",postStatus:s?.postStatus??"PUBLISHED"};await b.put(`/boards/update/${d}`,t),await k(),v(!1)}catch(t){console.error("PUT /boards/update error:",{status:t?.response?.status,data:t?.response?.data,message:t?.message}),c(t?.response?.data?.message??t?.response?.data?.error??"수정에 실패했습니다. 잠시 후 다시 시도하세요.")}finally{S(!1)}}},H=async()=>{if(i&&confirm("정말 삭제하시겠습니까? (소프트 삭제)")){A(!0);try{const t=a?.id??a?.memberId??0;await b.delete(`/boards/delete/${d}`,{data:{requesterId:t,reason:"공지 삭제"}}),alert("삭제되었습니다."),C()}catch(t){console.error(t),alert("삭제에 실패했습니다.")}finally{A(!1)}}};return e.jsxs("section",{className:"w-full max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"공지사항"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"공지 상세"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:C,className:"rounded-2xl px-4 py-2 shadow-sm ring-1 ring-gray-200 bg-white text-gray-700 hover:bg-gray-50 transition",children:"목록"}),i&&e.jsx(e.Fragment,{children:m?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:q,disabled:y,className:"rounded-2xl px-4 py-2 shadow-sm text-white bg-gradient-to-r from-pink-300 to-purple-300 hover:opacity-90 transition disabled:opacity-60",children:y?"저장 중…":"저장"}),e.jsx("button",{onClick:P,disabled:y,className:"rounded-2xl px-4 py-2 shadow-sm ring-1 ring-gray-200 bg-white text-gray-700 hover:bg-gray-50 transition disabled:opacity-60",children:"취소"})]}):e.jsx("button",{onClick:P,className:"rounded-2xl px-4 py-2 shadow-sm text-white bg-gradient-to-r from-pink-300 to-purple-300 hover:opacity-90 transition",children:"수정"})}),M&&i&&e.jsx("button",{onClick:H,disabled:E,className:"rounded-2xl px-4 py-2 shadow-sm ring-1 ring-rose-200 bg-rose-50 text-rose-700 hover:bg-rose-100 transition disabled:opacity-60",children:E?"삭제 중…":"삭제"})]})]}),e.jsxs("div",{className:"rounded-3xl border border-gray-200 bg-white shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-5 md:px-6 py-5 border-b border-gray-100",children:N?e.jsx("div",{className:"h-6 w-2/3 bg-gray-100 rounded animate-pulse"}):u?e.jsx("p",{className:"text-sm text-rose-600",children:u}):e.jsxs(e.Fragment,{children:[m?i?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"제목"}),e.jsx("input",{type:"text",value:x,onChange:t=>p(t.target.value),className:"w-full rounded-xl border text-sm px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-200 border-gray-200",maxLength:160})]}):null:e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900 break-words",children:s?.title}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs ${L}`,children:s?.postStatus==="PUBLISHED"?"게시중":s?.postStatus==="HIDDEN"?"숨김":s?.postStatus==="DELETED"?"삭제됨":s?.postStatus}),s?.requireAdminPost&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-gray-50 ring-1 ring-gray-200 text-gray-700",children:"중요"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-gray-50 ring-1 ring-gray-200 text-gray-600",children:"공지"}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsxs("span",{className:"text-gray-600",children:["등록 ",I(s?.regDate)]}),s?.modDate&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsxs("span",{className:"text-gray-600",children:["수정 ",I(s?.modDate)]})]})]})]})}),e.jsx("div",{className:"px-5 md:px-6 py-6",children:N?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-100 rounded animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-100 rounded animate-pulse w-11/12"}),e.jsx("div",{className:"h-4 bg-gray-100 rounded animate-pulse w-10/12"}),e.jsx("div",{className:"h-4 bg-gray-100 rounded animate-pulse w-9/12"})]}):u?e.jsx("p",{className:"text-sm text-rose-600",children:u}):m?i?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"내용"}),e.jsx("textarea",{value:g,onChange:t=>h(t.target.value),className:"w-full min-h-[220px] rounded-xl border text-sm px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-200 resize-y border-gray-200",placeholder:"수정할 내용을 입력하세요."}),D&&e.jsx("p",{className:"mt-2 text-sm text-rose-600",children:D})]}):null:e.jsx("article",{className:"prose prose-sm md:prose-base max-w-none text-gray-900 whitespace-pre-wrap break-words",children:s?.content})})]})]})}export{G as default};
