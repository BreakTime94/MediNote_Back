import{al as B,aJ as U,a as t,an as u,ao as e,aK as V}from"./index-D3Bzzjcr.js";import{u as S,c as q,g as z,M as D}from"./healthScoreCalculator-CBAA5TLi.js";function Z({id:p,onMypage:I}){const C=B(),b=U(),[h,P]=t.useState(p),[n,j]=t.useState({}),[Y,E]=t.useState(0),[x,O]=t.useState({grade:"-",text:"-",color:"#gray"});t.useEffect(()=>{h==null&&P(b.id)},[b.id,p]);const[a,i]=t.useState(null),[T,y]=t.useState(!0),[f,K]=t.useState([]),[v,M]=t.useState([]),[N,H]=t.useState(""),[k,w]=t.useState([]),g=t.useRef(null),c=S(f),m=S(v);t.useEffect(()=>{if(a){const s=q(a),r=z(s);E(s),O(r)}},[a]),t.useEffect(()=>{(async()=>{try{const[r,l]=await Promise.all([u.get("/health/condition/chronicDiseases"),u.get("/health/condition/allergies")]);K(r.data||[]),M(l.data||[])}catch(r){console.error("ì§ˆí™˜/ì•ŒëŸ¬ì§€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:",r)}})()},[]),t.useEffect(()=>{h&&A()},[h]);const A=async()=>{try{const s=await u.get("/health/measurement/latest"),r=(s.data.medicationIds||[]).map((l,d)=>({id:l,nameKo:s.data.medicationNames?.[d]||"ì•½í’ˆëª… ì—†ìŒ",company:""}));i({...s.data,chronicDiseaseIds:s.data.chronicDiseaseIds||[],allergyIds:s.data.allergyIds||[],medications:r}),y(!1)}catch(s){console.error("ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:",s),alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),y(!1)}},o=s=>{const{name:r,value:l}=s.target,d={...a,[r]:l};i(d);const J=D(d);j(J)},L=s=>{if(!s.trim()){w([]);return}g.current&&clearTimeout(g.current),g.current=setTimeout(async()=>{try{const r=await u.get(`/health/medication/search?keyword=${s}`);w(Array.isArray(r.data)?r.data:[])}catch(r){console.error("ì•½ ê²€ìƒ‰ ì‹¤íŒ¨:",r)}},300)},R=s=>{if(a.medications||(a.medications=[]),a.medications.some(l=>l.id===s.medicationId))return;const r={id:s.medicationId,nameKo:s.nameKo,company:s.company||""};i(l=>({...l,medications:[...l.medications,r]}))},W=s=>{i(r=>({...r,medications:r.medications.filter(l=>l.id!==s)}))},$=s=>{a.chronicDiseaseIds?.includes(s.id)||(i(r=>({...r,chronicDiseaseIds:[...r.chronicDiseaseIds||[],s.id]})),c.reset())},G=s=>{a.allergyIds?.includes(s.id)||(i(r=>({...r,allergyIds:[...r.allergyIds||[],s.id]})),m.reset())},F=async()=>{const s=D(a);if(Object.keys(s).length>0){j(s),alert(Object.values(s)[0]);return}if(!window.confirm(`ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
ìƒˆ ì´ë ¥ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.`))return;const r={gender:a.gender,smoking:a.smoking,drinking:a.drinking,drinkingType:a.drinkingType,drinkingPerWeek:a.drinkingPerWeek,drinkingPerOnce:a.drinkingPerOnce,chronicDiseaseYn:a.chronicDiseaseYn===!0||a.chronicDiseaseYn==="true",chronicDiseaseIds:a.chronicDiseaseIds||[],allergyYn:a.allergyYn===!0||a.allergyYn==="true",allergyIds:a.allergyIds||[],medicationYn:a.medicationYn===!0||a.medicationYn==="true",medicationIds:a.medications?.map(l=>l.id)||[],height:a.height,weight:a.weight,bloodPressureSystolic:a.bloodPressureSystolic,bloodPressureDiastolic:a.bloodPressureDiastolic,bloodSugar:a.bloodSugar,sleepHours:a.sleepHours,birthDate:a.birthDate};try{await u.put("/health/measurement/update",r),alert("ê±´ê°•ì •ë³´ê°€ ìƒˆ ì´ë ¥ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."),p?I():C("/mycare/list")}catch(l){console.error("ì €ì¥ ì‹¤íŒ¨:",l),alert("ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.")}};return T||!a?e.jsx("p",{className:"text-center mt-10 text-gray-500",children:"ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..."}):e.jsxs("div",{className:"max-w-3xl mx-auto bg-white p-8 rounded-2xl shadow-md",children:[e.jsx("h1",{className:"text-3xl font-extrabold bg-gradient-to-r from-pink-400 to-purple-500 text-transparent bg-clip-text text-center mb-8",children:"ê±´ê°•ì •ë³´ ìˆ˜ì •"}),e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl border-2 border-purple-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1 font-semibold",children:"ì˜ˆìƒ ê±´ê°•ì ìˆ˜"}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("span",{className:"text-5xl font-bold",style:{color:x.color},children:Y}),e.jsx("span",{className:"text-xl text-gray-500 mb-2",children:"ì "})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-4xl font-bold mb-1",style:{color:x.color},children:x.grade}),e.jsx("div",{className:"text-sm text-gray-600 font-semibold",children:x.text})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-purple-200",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx("span",{className:"text-base",children:"ğŸ’¡"}),e.jsx("span",{children:"ìˆ˜ì • ë‚´ìš©ì´ ë°˜ì˜ëœ ì˜ˆìƒ ì ìˆ˜ì…ë‹ˆë‹¤"})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"ìƒë…„ì›”ì¼"}),e.jsx("input",{type:"date",name:"birthDate",value:a.birthDate||"",onChange:o,className:"mt-2 w-full border rounded-lg px-3 py-2"}),(a.age||a.ageGroup)&&e.jsxs("p",{className:"text-gray-600 text-sm mt-1",children:["ë‚˜ì´: ",e.jsx("span",{className:"font-medium",children:a.age||"-"}),"ì„¸ / ì—°ë ¹ëŒ€:"," ",e.jsx("span",{className:"font-medium",children:a.ageGroup||"-"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"ì„±ë³„"}),e.jsxs("select",{name:"gender",value:a.gender||"",onChange:o,className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"ì„ íƒ"}),e.jsx("option",{value:"MALE",children:"ë‚¨ì„±"}),e.jsx("option",{value:"FEMALE",children:"ì—¬ì„±"}),e.jsx("option",{value:"OTHER",children:"ê¸°íƒ€"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"í¡ì—° ì—¬ë¶€"}),e.jsxs("select",{name:"smoking",value:String(a.smoking),onChange:s=>i({...a,smoking:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"ì•„ë‹ˆì˜¤"}),e.jsx("option",{value:"true",children:"ì˜ˆ"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"ìŒì£¼ ì—¬ë¶€"}),e.jsxs("select",{name:"drinking",value:String(a.drinking),onChange:s=>i({...a,drinking:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"ì•„ë‹ˆì˜¤"}),e.jsx("option",{value:"true",children:"ì˜ˆ"})]})]}),a.drinking&&e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"ì£¼ì¢… ì„ íƒ"}),e.jsxs("select",{name:"drinkingType",value:a.drinkingType||"",onChange:o,className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"ì„ íƒ"}),e.jsx("option",{value:"SOJU",children:"ì†Œì£¼"}),e.jsx("option",{value:"BEER",children:"ë§¥ì£¼"}),e.jsx("option",{value:"WINE",children:"ì™€ì¸"}),e.jsx("option",{value:"WHISKY",children:"ìœ„ìŠ¤í‚¤"}),e.jsx("option",{value:"MAKGEOLLI",children:"ë§‰ê±¸ë¦¬"}),e.jsx("option",{value:"COCKTAIL",children:"ì¹µí…Œì¼"}),e.jsx("option",{value:"ETC",children:"ê¸°íƒ€"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"ì£¼ë‹¹ ìŒì£¼ íšŸìˆ˜"}),e.jsx("input",{type:"number",name:"drinkingPerWeek",value:a.drinkingPerWeek||"",onChange:o,placeholder:"íšŒ",step:"0.1",min:"0",className:"border rounded-lg px-3 py-2 w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"1íšŒë‹¹ ìŒì£¼ëŸ‰ (ë‹¨ìœ„ ìë™)"}),e.jsx("input",{type:"number",name:"drinkingPerOnce",value:a.drinkingPerOnce||"",onChange:o,placeholder:a.drinkingType==="BEER"?"ì˜ˆ: 3ìº” (500ml)":a.drinkingType==="SOJU"?"ì˜ˆ: ë°˜ë³‘~1ë³‘":a.drinkingType==="WINE"?"ì˜ˆ: 2ì”":a.drinkingType==="WHISKY"?"ì˜ˆ: 1ì”":a.drinkingType==="MAKGEOLLI"?"ì˜ˆ: 2ì»µ":a.drinkingType==="COCKTAIL"?"ì˜ˆ: 2ì”":"ì˜ˆ: 1íšŒë‹¹ ìŒì£¼ëŸ‰ ì…ë ¥",step:"0.1",min:"0",className:"border rounded-lg px-3 py-2 w-full"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"ê¸°ì €ì§ˆí™˜ ì—¬ë¶€"}),e.jsxs("select",{name:"chronicDiseaseYn",value:String(a.chronicDiseaseYn),onChange:s=>i({...a,chronicDiseaseYn:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"ì•„ë‹ˆì˜¤"}),e.jsx("option",{value:"true",children:"ì˜ˆ"})]}),a.chronicDiseaseYn===!0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("input",{type:"text",placeholder:"ê¸°ì €ì§ˆí™˜ ê²€ìƒ‰",value:c.keyword,onChange:s=>c.handleSearch(s.target.value),className:"border rounded-lg px-3 py-2 w-full"}),c.results.length>0&&e.jsx("ul",{className:"mt-2 border rounded-lg p-2 bg-gray-50 max-h-40 overflow-y-auto",children:c.results.map(s=>e.jsxs("li",{className:"cursor-pointer hover:text-pink-600 py-1",onClick:()=>$(s),children:["+ ",s.nameKo]},s.id))}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:a.chronicDiseaseIds?.map(s=>{const r=f.find(l=>l.id===s);return e.jsxs("span",{className:"bg-blue-200 text-sm px-2 py-1 rounded flex items-center space-x-1",children:[r?.nameKo,e.jsx("button",{onClick:()=>i(l=>({...l,chronicDiseaseIds:l.chronicDiseaseIds.filter(d=>d!==s)})),className:"text-red-500",children:"âœ•"})]},s)})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"ì•ŒëŸ¬ì§€ ì—¬ë¶€"}),e.jsxs("select",{name:"allergyYn",value:String(a.allergyYn),onChange:s=>i({...a,allergyYn:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"ì•„ë‹ˆì˜¤"}),e.jsx("option",{value:"true",children:"ì˜ˆ"})]}),a.allergyYn===!0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("input",{type:"text",placeholder:"ì•ŒëŸ¬ì§€ ê²€ìƒ‰",value:m.keyword,onChange:s=>m.handleSearch(s.target.value),className:"border rounded-lg px-3 py-2 w-full"}),m.results.length>0&&e.jsx("ul",{className:"mt-2 border rounded-lg p-2 bg-gray-50 max-h-40 overflow-y-auto",children:m.results.map(s=>e.jsxs("li",{className:"cursor-pointer hover:text-pink-600 py-1",onClick:()=>G(s),children:["+ ",s.nameKo]},s.id))}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:a.allergyIds?.map(s=>{const r=v.find(l=>l.id===s);return e.jsxs("span",{className:"bg-green-200 text-sm px-2 py-1 rounded flex items-center space-x-1",children:[r?.nameKo,e.jsx("button",{onClick:()=>i(l=>({...l,allergyIds:l.allergyIds.filter(d=>d!==s)})),className:"text-red-500",children:"âœ•"})]},s)})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"ë³µìš©ì•½ ì—¬ë¶€"}),e.jsxs("select",{name:"medicationYn",value:String(a.medicationYn),onChange:s=>i({...a,medicationYn:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"ì•„ë‹ˆì˜¤"}),e.jsx("option",{value:"true",children:"ì˜ˆ"})]}),a.medicationYn===!0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("input",{type:"text",placeholder:"ë³µìš©ì•½ ê²€ìƒ‰",value:N,onChange:s=>{H(s.target.value),L(s.target.value)},className:"border rounded-lg px-3 py-2 w-full"}),N.length>0&&k.length>0&&e.jsx("ul",{className:"mt-2 border rounded-lg p-2 bg-gray-50 max-h-40 overflow-y-auto",children:k.map(s=>e.jsxs("li",{className:"cursor-pointer hover:text-pink-600 py-1",onClick:()=>R(s),children:["+ ",s.nameKo," ",s.company&&`(${s.company})`]},s.medicationId))}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:a.medications?.map(s=>e.jsxs("span",{className:"bg-purple-200 text-sm px-2 py-1 rounded flex items-center space-x-1",children:[s.nameKo,e.jsx("button",{onClick:()=>W(s.id),className:"text-red-500",children:"âœ•"})]},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"í‚¤ (cm)"}),e.jsx("input",{type:"number",name:"height",value:a.height||"",onChange:o,placeholder:"169",step:"0.1",min:"0",max:"300",className:`border rounded-lg px-3 py-2 w-full ${n.height?"border-red-400":""}`}),n.height&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.height})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"ì²´ì¤‘ (kg)"}),e.jsx("input",{type:"number",name:"weight",value:a.weight||"",onChange:o,placeholder:"73",step:"0.1",min:"0",max:"500",className:`border rounded-lg px-3 py-2 w-full ${n.weight?"border-red-400":""}`}),n.weight&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.weight})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"ìˆ˜ì¶•ê¸° í˜ˆì••"}),e.jsx("input",{type:"number",name:"bloodPressureSystolic",value:a.bloodPressureSystolic||"",onChange:o,placeholder:"118",step:"1",min:"0",max:"300",className:`border rounded-lg px-3 py-2 w-full ${n.bloodPressureSystolic?"border-red-400":""}`}),n.bloodPressureSystolic&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.bloodPressureSystolic})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"ì´ì™„ê¸° í˜ˆì••"}),e.jsx("input",{type:"number",name:"bloodPressureDiastolic",value:a.bloodPressureDiastolic||"",onChange:o,placeholder:"81",step:"1",min:"0",max:"200",className:`border rounded-lg px-3 py-2 w-full ${n.bloodPressureDiastolic?"border-red-400":""}`}),n.bloodPressureDiastolic&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.bloodPressureDiastolic}),n.bloodPressure&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.bloodPressure})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"í˜ˆë‹¹ (mg/dL)"}),e.jsx("input",{type:"number",name:"bloodSugar",value:a.bloodSugar||"",onChange:o,placeholder:"90",step:"1",min:"0",max:"600",className:`border rounded-lg px-3 py-2 w-full ${n.bloodSugar?"border-red-400":""}`}),n.bloodSugar&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.bloodSugar})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"ìˆ˜ë©´ ì‹œê°„ (ì‹œê°„)"}),e.jsx("input",{type:"number",name:"sleepHours",value:a.sleepHours||"",onChange:o,placeholder:"7",step:"0.5",min:"0",max:"24",className:`border rounded-lg px-3 py-2 w-full ${n.sleepHours?"border-red-400":""}`}),n.sleepHours&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.sleepHours})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"ì¸¡ì •ì¼"}),e.jsx("p",{className:"mt-2 border rounded-lg px-3 py-2 bg-gray-50",children:a.measuredDate?V(a.measuredDate).format("YYYY-MM-DD HH:mm"):"-"})]})]}),e.jsx("div",{className:"flex justify-center mt-10 space-x-4",children:e.jsx("button",{onClick:F,className:"px-6 py-2 rounded-lg text-white font-semibold bg-gradient-to-r from-pink-400 to-purple-500 hover:opacity-90 transition",children:"ìˆ˜ì •(ìƒˆ ì´ë ¥ ì €ì¥)"})})]})}export{Z as default};
