import{al as B,aJ as U,a as t,an as u,ao as e,aK as V}from"./index-D3Bzzjcr.js";import{u as S,c as q,g as z,M as D}from"./healthScoreCalculator-CBAA5TLi.js";function Z({id:p,onMypage:I}){const C=B(),b=U(),[h,P]=t.useState(p),[n,j]=t.useState({}),[Y,E]=t.useState(0),[x,O]=t.useState({grade:"-",text:"-",color:"#gray"});t.useEffect(()=>{h==null&&P(b.id)},[b.id,p]);const[a,i]=t.useState(null),[T,y]=t.useState(!0),[f,K]=t.useState([]),[v,M]=t.useState([]),[N,H]=t.useState(""),[k,w]=t.useState([]),g=t.useRef(null),c=S(f),m=S(v);t.useEffect(()=>{if(a){const s=q(a),r=z(s);E(s),O(r)}},[a]),t.useEffect(()=>{(async()=>{try{const[r,l]=await Promise.all([u.get("/health/condition/chronicDiseases"),u.get("/health/condition/allergies")]);K(r.data||[]),M(l.data||[])}catch(r){console.error("질환/알러지 목록 불러오기 실패:",r)}})()},[]),t.useEffect(()=>{h&&A()},[h]);const A=async()=>{try{const s=await u.get("/health/measurement/latest"),r=(s.data.medicationIds||[]).map((l,d)=>({id:l,nameKo:s.data.medicationNames?.[d]||"약품명 없음",company:""}));i({...s.data,chronicDiseaseIds:s.data.chronicDiseaseIds||[],allergyIds:s.data.allergyIds||[],medications:r}),y(!1)}catch(s){console.error("데이터 조회 실패:",s),alert("데이터를 불러올 수 없습니다."),y(!1)}},o=s=>{const{name:r,value:l}=s.target,d={...a,[r]:l};i(d);const J=D(d);j(J)},L=s=>{if(!s.trim()){w([]);return}g.current&&clearTimeout(g.current),g.current=setTimeout(async()=>{try{const r=await u.get(`/health/medication/search?keyword=${s}`);w(Array.isArray(r.data)?r.data:[])}catch(r){console.error("약 검색 실패:",r)}},300)},R=s=>{if(a.medications||(a.medications=[]),a.medications.some(l=>l.id===s.medicationId))return;const r={id:s.medicationId,nameKo:s.nameKo,company:s.company||""};i(l=>({...l,medications:[...l.medications,r]}))},W=s=>{i(r=>({...r,medications:r.medications.filter(l=>l.id!==s)}))},$=s=>{a.chronicDiseaseIds?.includes(s.id)||(i(r=>({...r,chronicDiseaseIds:[...r.chronicDiseaseIds||[],s.id]})),c.reset())},G=s=>{a.allergyIds?.includes(s.id)||(i(r=>({...r,allergyIds:[...r.allergyIds||[],s.id]})),m.reset())},F=async()=>{const s=D(a);if(Object.keys(s).length>0){j(s),alert(Object.values(s)[0]);return}if(!window.confirm(`수정하시겠습니까?
새 이력으로 저장됩니다.`))return;const r={gender:a.gender,smoking:a.smoking,drinking:a.drinking,drinkingType:a.drinkingType,drinkingPerWeek:a.drinkingPerWeek,drinkingPerOnce:a.drinkingPerOnce,chronicDiseaseYn:a.chronicDiseaseYn===!0||a.chronicDiseaseYn==="true",chronicDiseaseIds:a.chronicDiseaseIds||[],allergyYn:a.allergyYn===!0||a.allergyYn==="true",allergyIds:a.allergyIds||[],medicationYn:a.medicationYn===!0||a.medicationYn==="true",medicationIds:a.medications?.map(l=>l.id)||[],height:a.height,weight:a.weight,bloodPressureSystolic:a.bloodPressureSystolic,bloodPressureDiastolic:a.bloodPressureDiastolic,bloodSugar:a.bloodSugar,sleepHours:a.sleepHours,birthDate:a.birthDate};try{await u.put("/health/measurement/update",r),alert("건강정보가 새 이력으로 저장되었습니다."),p?I():C("/mycare/list")}catch(l){console.error("저장 실패:",l),alert("저장에 실패했습니다. 다시 시도해주세요.")}};return T||!a?e.jsx("p",{className:"text-center mt-10 text-gray-500",children:"데이터 불러오는 중..."}):e.jsxs("div",{className:"max-w-3xl mx-auto bg-white p-8 rounded-2xl shadow-md",children:[e.jsx("h1",{className:"text-3xl font-extrabold bg-gradient-to-r from-pink-400 to-purple-500 text-transparent bg-clip-text text-center mb-8",children:"건강정보 수정"}),e.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl border-2 border-purple-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1 font-semibold",children:"예상 건강점수"}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("span",{className:"text-5xl font-bold",style:{color:x.color},children:Y}),e.jsx("span",{className:"text-xl text-gray-500 mb-2",children:"점"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-4xl font-bold mb-1",style:{color:x.color},children:x.grade}),e.jsx("div",{className:"text-sm text-gray-600 font-semibold",children:x.text})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-purple-200",children:e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx("span",{className:"text-base",children:"💡"}),e.jsx("span",{children:"수정 내용이 반영된 예상 점수입니다"})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"생년월일"}),e.jsx("input",{type:"date",name:"birthDate",value:a.birthDate||"",onChange:o,className:"mt-2 w-full border rounded-lg px-3 py-2"}),(a.age||a.ageGroup)&&e.jsxs("p",{className:"text-gray-600 text-sm mt-1",children:["나이: ",e.jsx("span",{className:"font-medium",children:a.age||"-"}),"세 / 연령대:"," ",e.jsx("span",{className:"font-medium",children:a.ageGroup||"-"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"성별"}),e.jsxs("select",{name:"gender",value:a.gender||"",onChange:o,className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"MALE",children:"남성"}),e.jsx("option",{value:"FEMALE",children:"여성"}),e.jsx("option",{value:"OTHER",children:"기타"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"흡연 여부"}),e.jsxs("select",{name:"smoking",value:String(a.smoking),onChange:s=>i({...a,smoking:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"아니오"}),e.jsx("option",{value:"true",children:"예"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"음주 여부"}),e.jsxs("select",{name:"drinking",value:String(a.drinking),onChange:s=>i({...a,drinking:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"아니오"}),e.jsx("option",{value:"true",children:"예"})]})]}),a.drinking&&e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"주종 선택"}),e.jsxs("select",{name:"drinkingType",value:a.drinkingType||"",onChange:o,className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"선택"}),e.jsx("option",{value:"SOJU",children:"소주"}),e.jsx("option",{value:"BEER",children:"맥주"}),e.jsx("option",{value:"WINE",children:"와인"}),e.jsx("option",{value:"WHISKY",children:"위스키"}),e.jsx("option",{value:"MAKGEOLLI",children:"막걸리"}),e.jsx("option",{value:"COCKTAIL",children:"칵테일"}),e.jsx("option",{value:"ETC",children:"기타"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"주당 음주 횟수"}),e.jsx("input",{type:"number",name:"drinkingPerWeek",value:a.drinkingPerWeek||"",onChange:o,placeholder:"회",step:"0.1",min:"0",className:"border rounded-lg px-3 py-2 w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"1회당 음주량 (단위 자동)"}),e.jsx("input",{type:"number",name:"drinkingPerOnce",value:a.drinkingPerOnce||"",onChange:o,placeholder:a.drinkingType==="BEER"?"예: 3캔 (500ml)":a.drinkingType==="SOJU"?"예: 반병~1병":a.drinkingType==="WINE"?"예: 2잔":a.drinkingType==="WHISKY"?"예: 1잔":a.drinkingType==="MAKGEOLLI"?"예: 2컵":a.drinkingType==="COCKTAIL"?"예: 2잔":"예: 1회당 음주량 입력",step:"0.1",min:"0",className:"border rounded-lg px-3 py-2 w-full"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"기저질환 여부"}),e.jsxs("select",{name:"chronicDiseaseYn",value:String(a.chronicDiseaseYn),onChange:s=>i({...a,chronicDiseaseYn:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"아니오"}),e.jsx("option",{value:"true",children:"예"})]}),a.chronicDiseaseYn===!0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("input",{type:"text",placeholder:"기저질환 검색",value:c.keyword,onChange:s=>c.handleSearch(s.target.value),className:"border rounded-lg px-3 py-2 w-full"}),c.results.length>0&&e.jsx("ul",{className:"mt-2 border rounded-lg p-2 bg-gray-50 max-h-40 overflow-y-auto",children:c.results.map(s=>e.jsxs("li",{className:"cursor-pointer hover:text-pink-600 py-1",onClick:()=>$(s),children:["+ ",s.nameKo]},s.id))}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:a.chronicDiseaseIds?.map(s=>{const r=f.find(l=>l.id===s);return e.jsxs("span",{className:"bg-blue-200 text-sm px-2 py-1 rounded flex items-center space-x-1",children:[r?.nameKo,e.jsx("button",{onClick:()=>i(l=>({...l,chronicDiseaseIds:l.chronicDiseaseIds.filter(d=>d!==s)})),className:"text-red-500",children:"✕"})]},s)})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"알러지 여부"}),e.jsxs("select",{name:"allergyYn",value:String(a.allergyYn),onChange:s=>i({...a,allergyYn:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"아니오"}),e.jsx("option",{value:"true",children:"예"})]}),a.allergyYn===!0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("input",{type:"text",placeholder:"알러지 검색",value:m.keyword,onChange:s=>m.handleSearch(s.target.value),className:"border rounded-lg px-3 py-2 w-full"}),m.results.length>0&&e.jsx("ul",{className:"mt-2 border rounded-lg p-2 bg-gray-50 max-h-40 overflow-y-auto",children:m.results.map(s=>e.jsxs("li",{className:"cursor-pointer hover:text-pink-600 py-1",onClick:()=>G(s),children:["+ ",s.nameKo]},s.id))}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:a.allergyIds?.map(s=>{const r=v.find(l=>l.id===s);return e.jsxs("span",{className:"bg-green-200 text-sm px-2 py-1 rounded flex items-center space-x-1",children:[r?.nameKo,e.jsx("button",{onClick:()=>i(l=>({...l,allergyIds:l.allergyIds.filter(d=>d!==s)})),className:"text-red-500",children:"✕"})]},s)})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold",children:"복용약 여부"}),e.jsxs("select",{name:"medicationYn",value:String(a.medicationYn),onChange:s=>i({...a,medicationYn:s.target.value==="true"}),className:"mt-2 w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"false",children:"아니오"}),e.jsx("option",{value:"true",children:"예"})]}),a.medicationYn===!0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("input",{type:"text",placeholder:"복용약 검색",value:N,onChange:s=>{H(s.target.value),L(s.target.value)},className:"border rounded-lg px-3 py-2 w-full"}),N.length>0&&k.length>0&&e.jsx("ul",{className:"mt-2 border rounded-lg p-2 bg-gray-50 max-h-40 overflow-y-auto",children:k.map(s=>e.jsxs("li",{className:"cursor-pointer hover:text-pink-600 py-1",onClick:()=>R(s),children:["+ ",s.nameKo," ",s.company&&`(${s.company})`]},s.medicationId))}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:a.medications?.map(s=>e.jsxs("span",{className:"bg-purple-200 text-sm px-2 py-1 rounded flex items-center space-x-1",children:[s.nameKo,e.jsx("button",{onClick:()=>W(s.id),className:"text-red-500",children:"✕"})]},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"키 (cm)"}),e.jsx("input",{type:"number",name:"height",value:a.height||"",onChange:o,placeholder:"169",step:"0.1",min:"0",max:"300",className:`border rounded-lg px-3 py-2 w-full ${n.height?"border-red-400":""}`}),n.height&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.height})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"체중 (kg)"}),e.jsx("input",{type:"number",name:"weight",value:a.weight||"",onChange:o,placeholder:"73",step:"0.1",min:"0",max:"500",className:`border rounded-lg px-3 py-2 w-full ${n.weight?"border-red-400":""}`}),n.weight&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.weight})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"수축기 혈압"}),e.jsx("input",{type:"number",name:"bloodPressureSystolic",value:a.bloodPressureSystolic||"",onChange:o,placeholder:"118",step:"1",min:"0",max:"300",className:`border rounded-lg px-3 py-2 w-full ${n.bloodPressureSystolic?"border-red-400":""}`}),n.bloodPressureSystolic&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.bloodPressureSystolic})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"이완기 혈압"}),e.jsx("input",{type:"number",name:"bloodPressureDiastolic",value:a.bloodPressureDiastolic||"",onChange:o,placeholder:"81",step:"1",min:"0",max:"200",className:`border rounded-lg px-3 py-2 w-full ${n.bloodPressureDiastolic?"border-red-400":""}`}),n.bloodPressureDiastolic&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.bloodPressureDiastolic}),n.bloodPressure&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.bloodPressure})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"혈당 (mg/dL)"}),e.jsx("input",{type:"number",name:"bloodSugar",value:a.bloodSugar||"",onChange:o,placeholder:"90",step:"1",min:"0",max:"600",className:`border rounded-lg px-3 py-2 w-full ${n.bloodSugar?"border-red-400":""}`}),n.bloodSugar&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.bloodSugar})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"수면 시간 (시간)"}),e.jsx("input",{type:"number",name:"sleepHours",value:a.sleepHours||"",onChange:o,placeholder:"7",step:"0.5",min:"0",max:"24",className:`border rounded-lg px-3 py-2 w-full ${n.sleepHours?"border-red-400":""}`}),n.sleepHours&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.sleepHours})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-semibold text-gray-700",children:"측정일"}),e.jsx("p",{className:"mt-2 border rounded-lg px-3 py-2 bg-gray-50",children:a.measuredDate?V(a.measuredDate).format("YYYY-MM-DD HH:mm"):"-"})]})]}),e.jsx("div",{className:"flex justify-center mt-10 space-x-4",children:e.jsx("button",{onClick:F,className:"px-6 py-2 rounded-lg text-white font-semibold bg-gradient-to-r from-pink-400 to-purple-500 hover:opacity-90 transition",children:"수정(새 이력 저장)"})})]})}export{Z as default};
