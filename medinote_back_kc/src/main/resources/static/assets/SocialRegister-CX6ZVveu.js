import{aF as z,a as r,al as D,am as L,ao as e,an as Z}from"./index-D3Bzzjcr.js";import{U as j}from"./UseDuplicateCheck-CCrvuKal.js";import{T as $}from"./TermsSection-BkNx7g1u.js";function U(){const v=z(),{provider:k,member:h}=v.state,[t,N]=r.useState({...h,nickname:h.nickname?.trim().replace(/\s+/g,"")||"",extraEmail:"",agreements:[]}),y=D(),[n,E]=r.useState({}),{setMember:w}=L(),[l,p]=r.useState({extraEmail:!1,nickname:!1}),[c,S]=r.useState({service:!1,privacy:!1,marketing:!1}),[C,A]=r.useState([]),d={...t,agreements:C.map(s=>({termsId:s.id,agreed:c[s.policyCode]||!1}))},g=s=>{const{name:a,value:u}=s.target;p(i=>({...i,[a]:!0})),E(i=>({...i,[a]:x(a,u)}))},x=(s,a)=>{switch(s){case"extraEmail":if(!a)return"추가 이메일은 필수입니다.";if(!/^(?!.*\s)[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(a))return"이메일은 공백이 없어야 하며, 올바른 형식이어야 합니다. ex) aaa@bbb.ccc 등";break;case"nickname":if(!a)return"닉네임은 필수입니다.";if(!/^(?!.*\s)[가-힣a-zA-Z0-9 ]{2,16}$/.test(a))return"닉네임은 공백없이 한글, 영문, 숫자만 사용하여 2~16자까지 가능합니다.";break;default:return""}return""},b=s=>{const{name:a,value:u}=s.target;s.preventDefault(),N({...t,[a]:u}),l[a]||p(i=>({...i,[a]:!0}))},o=j("email",t.extraEmail,"/member/check/email",x),m=j("nickname",t.nickname,"/member/check/nickname",x),f=Object.values(n).some(s=>s&&s.length>0)||o!=="available"||m!=="available"||c.privacy===!1||c.service===!1,T=s=>{window.confirm("정말 제출하시겠습니까?")&&(console.log("payload:",d),console.log("agreements:",d.agreements),s.preventDefault(),Z.post("/social/auth/register",d,{withCredentials:!0}).then(a=>{console.log("Content-type :",a.headers["content-type"]),w({...t,provider:k}),y("/")}).catch(a=>{console.log("Error : ",a)}))};return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:e.jsxs("div",{className:"bg-white shadow-lg rounded-2xl p-8 w-96",children:[e.jsx("div",{className:"mb-2 font-bold text-2xl",children:e.jsx("span",{children:"가입이 거의 완료되었어요!"})}),e.jsx("div",{className:"mb-2 text-sm",children:e.jsxs("span",{children:["가입하시는 이메일: ",t.email]})}),e.jsx("div",{className:"mb-2",children:e.jsx("input",{type:"text",name:"extraEmail",placeholder:"추가이메일",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400",onBlur:g,onChange:b})}),l.email&&n.email&&e.jsx("ul",{className:"mt-2 text-xs",children:e.jsx("li",{className:"text-red-500",children:n.email})}),l.extraEmail&&!n.extraEmail&&o!=="idle"&&t.email!==t.extraEmail&&e.jsx("ul",{className:"my-2 text-xs",children:e.jsx("li",{className:o==="available"?"text-blue-500":"text-red-500",children:o==="available"?"사용 가능한 이메일입니다.":"사용하실 수 없는 이메일입니다."})}),l.extraEmail&&!n.extraEmail&&t.email===t.extraEmail&&e.jsx("ul",{className:"mt-2 text-xs",children:e.jsx("li",{className:"text-red-500",children:"주 이메일과 동일한 이메일을 사용하실 수 없습니다."})}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",name:"nickname",placeholder:"닉네임",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400",onBlur:g,onChange:b,value:t.nickname})}),l.nickname&&n.nickname&&e.jsx("ul",{className:"mt-2 text-xs",children:e.jsx("li",{className:"text-red-500",children:n.nickname})}),l.nickname&&!n.nickname&&m!=="idle"&&e.jsx("ul",{className:"mt-2 text-xs",children:e.jsx("li",{className:m==="available"?"text-blue-500":"text-red-500",children:m==="available"?"사용 가능한 닉네임입니다.":"사용하실 수 없는 닉네임입니다."})}),e.jsx($,{agreements:c,setAgreements:S,onTermsLoaded:A}),e.jsx("div",{className:"flex mt-3 gap-2",children:e.jsx("button",{type:"submit",className:`flex-1  text-white py-2 rounded-lg
                     ${f?"bg-gray-400 cursor-not-allowed":"bg-pink-300 hover:bg-pink-400 active:bg-pink-500 cursor-pointer"}`,disabled:f,onClick:T,children:"제출하기"})})]})})}export{U as default};
